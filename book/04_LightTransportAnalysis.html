
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Light Transport Analysis &#8212; Computational Imaging - Course Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Inverse Problems in Computational Imaging" href="05_InverseProblemsInCompimg.html" />
    <link rel="prev" title="Light Field Methods" href="03_LightFieldMethods.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Computational Imaging - Course Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Computational Imaging - Course Notes for Winter Term 2022 / 2023
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_Basics.html">
   Fundamental Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_LightFieldMethods.html">
   Light Field Methods
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Light Transport Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_InverseProblemsInCompimg.html">
   Inverse Problems in Computational Imaging
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/04_LightTransportAnalysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/04_LightTransportAnalysis.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#content">
   Content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-into-light-transport">
   Introduction into light transport
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-limitations">
     Practical limitations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optical-linear-algebra">
     Optical linear algebra
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#light-paths">
     Light paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#teaser">
     Teaser
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entries-of-the-light-transport-matrix">
     Entries of the light transport matrix
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#helmholtz-reciprocity-principle">
       Helmholtz reciprocity principle
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#light-transport-analysis-via-optical-computing">
   Light transport analysis via optical computing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optical-power-iteration">
     Optical power iteration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#power-iteration">
       Power iteration
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#implementation">
       Implementation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#limitations">
       Limitations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#krylov-subspace-methods">
     Krylov subspace methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optical-matrix-vector-multiplication-for-arbitrary-vectors">
       Optical matrix-vector multiplication for arbitrary vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#symmetry-of-transport-matrix">
       Symmetry of transport matrix
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#enforcing-symmetry-for-mathbf-t">
         Enforcing symmetry for
         <span class="math notranslate nohighlight">
          \(\mathbf{T}\)
         </span>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#low-rank-approximation-of-mathbf-t-via-optical-arnoldi">
       Low-rank approximation of
       <span class="math notranslate nohighlight">
        \(\mathbf{T}\)
       </span>
       via optical Arnoldi
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optical-matrix-inversion-via-gmres">
       Optical matrix inversion via GMRES
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#example-experiments">
         Example experiments
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#primal-dual-coding-for-optical-probing">
   Primal-Dual coding for optical probing
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Light Transport Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#content">
   Content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-into-light-transport">
   Introduction into light transport
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-limitations">
     Practical limitations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optical-linear-algebra">
     Optical linear algebra
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#light-paths">
     Light paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#teaser">
     Teaser
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entries-of-the-light-transport-matrix">
     Entries of the light transport matrix
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#helmholtz-reciprocity-principle">
       Helmholtz reciprocity principle
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#light-transport-analysis-via-optical-computing">
   Light transport analysis via optical computing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optical-power-iteration">
     Optical power iteration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#power-iteration">
       Power iteration
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#implementation">
       Implementation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#limitations">
       Limitations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#krylov-subspace-methods">
     Krylov subspace methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optical-matrix-vector-multiplication-for-arbitrary-vectors">
       Optical matrix-vector multiplication for arbitrary vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#symmetry-of-transport-matrix">
       Symmetry of transport matrix
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#enforcing-symmetry-for-mathbf-t">
         Enforcing symmetry for
         <span class="math notranslate nohighlight">
          \(\mathbf{T}\)
         </span>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#low-rank-approximation-of-mathbf-t-via-optical-arnoldi">
       Low-rank approximation of
       <span class="math notranslate nohighlight">
        \(\mathbf{T}\)
       </span>
       via optical Arnoldi
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optical-matrix-inversion-via-gmres">
       Optical matrix inversion via GMRES
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#example-experiments">
         Example experiments
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#primal-dual-coding-for-optical-probing">
   Primal-Dual coding for optical probing
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell tag_remove-input tag_book_only docutils container">
</div>
<p><span class="math notranslate nohighlight">\(\begin{align}
  \newcommand{transp}{^\intercal}
  \newcommand{F}{\mathcal{F}}
  \newcommand{Fi}{\mathcal{F}^{-1}}
  \newcommand{inv}{^{-1}}
  \newcommand{stochvec}[1]{\mathbf{\tilde{#1}}}
  \newcommand{argmax}[1]{\underset{#1}{\mathrm{arg\, max}}}
  \newcommand{argmin}[1]{\underset{#1}{\mathrm{arg\, min}}}
\end{align}\)</span></p>
<p><font size="7"> Computational Imaging </font><br><br><br></p>
<section class="tex2jax_ignore mathjax_ignore" id="light-transport-analysis">
<h1>Light Transport Analysis<a class="headerlink" href="#light-transport-analysis" title="Permalink to this headline">#</a></h1>
<section id="content">
<h2>Content<a class="headerlink" href="#content" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Introduction into light transport</p>
<ul>
<li><p>The light transport equation</p></li>
<li><p>The light transport matrix</p></li>
</ul>
</li>
<li><p>Optical computing for fast light transport</p>
<ul>
<li><p>Optical interpretation of matrix vector products</p></li>
<li><p>Krylov subspace methods (optical power iteration, optical Arnoldi)</p></li>
</ul>
</li>
<li><p>Light transport matrix processing for visual inspection</p>
<ul>
<li><p>Light transport matrix feature extraction</p></li>
<li><p>Signal-to-noise ratio based image fusion</p></li>
</ul>
</li>
<li><p>Separation of direct and indirect light transport</p>
<ul>
<li><p>Inverse light transport</p></li>
<li><p>Indirect appearance by structured light transport</p></li>
</ul>
</li>
<li><p>Compressed sensing for light transport analysis</p>
<ul>
<li><p>Introduction to compressed sensing</p></li>
<li><p>Compressive light transport matrix acquisition</p></li>
</ul>
</li>
</ul>
</section>
<section id="introduction-into-light-transport">
<h2>Introduction into light transport<a class="headerlink" href="#introduction-into-light-transport" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Light transport = all light travelling in a scene from illumination sources to sensor elements (i.e., pixels).</p></li>
<li><p>Can be mathematically described via the so-called <em>light transport matrix</em> <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, if the common assumption of linear light transport is made.</p></li>
</ul>
<p>The matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> contains the individual influences of all <span class="math notranslate nohighlight">\(P\)</span> light sources to all <span class="math notranslate nohighlight">\(I\)</span> sensor elements and hence has dimensions of <span class="math notranslate nohighlight">\(\mathbf{T} \in \mathbb{R}^{I\times P}_+\)</span>.</p>
<p>The elements of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> are non-negative as only positive energy or no energy can be transported via light.</p>
<p>The <em>light transport equation</em>
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{i} = \mathbf{T}\mathbf{p}
\end{align}\)</span>
describes the formation of the sensor values <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> of the <span class="math notranslate nohighlight">\(I\)</span> sensor elements when the scene is illuminated by the <span class="math notranslate nohighlight">\(P\)</span> light sources with respective intensities <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>.</p>
<p>For the following content, we will assume illumination of the scene by a projector projecting a two-dimensional image and a two-dimensional gray-value camera serving as the sensor.</p>
<p>In this case, <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> are the vector representations of the camera image, respectively, of the projected image or pattern.</p>
<p>If the light transport matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> is known, the camera image that would result from the illumination with an arbitrary pattern <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> could be synthetically calculated by just evaluating the light transport equation
<span class="math notranslate nohighlight">\(\begin{align} 
  \mathbf{i} = \mathbf{T}\mathbf{p} \,.
\end{align}\)</span></p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interact</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">showFig</span><span class="p">(</span><span class="s1">&#39;figures/4/desk_lightsources_example_&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;.svg&#39;</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="p">(</span><span class="n">min_i</span><span class="o">:=</span><span class="mi">1</span><span class="p">),</span><span class="nb">max</span><span class="o">=</span><span class="p">(</span><span class="n">max_i</span><span class="o">:=</span><span class="mi">5</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="n">max_i</span> <span class="k">if</span> <span class="n">book</span> <span class="k">else</span> <span class="n">min_i</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "6498cb6226ec45e69b568402e254fd61"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.&lt;lambda&gt;(i)&gt;
</pre></div>
</div>
</div>
</div>
<p>(All images in this chapter are kindly provided by Matthew O’Toole).</p>
<p>In this sense, the element <span class="math notranslate nohighlight">\(T[m,n]\)</span> of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> encodes the contribution of light source (i.e., projector pixel) <span class="math notranslate nohighlight">\(n\)</span> to camera pixel <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p>Unfortunately, the matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> is too large to measure and handle digitally for many practically relevant applications.</p>
</section>
<section id="practical-limitations">
<h3>Practical limitations<a class="headerlink" href="#practical-limitations" title="Permalink to this headline">#</a></h3>
<p>Consider a pair of a camera and a projector both having a (comparatively low) resolution of 1 mega pixels, then the resulting light transport matrix would have <span class="math notranslate nohighlight">\(10^{12}\)</span> elements.</p>
<ul class="simple">
<li><p>With an acquisition rate of <span class="math notranslate nohighlight">\(30\)</span> Hz, acquiring the required <span class="math notranslate nohighlight">\(10^6\)</span> measurements would need over 9 hours of time.</p></li>
<li><p>For a quantization of 8 bit per pixel for the camera images, <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> would require about one terabyte of storage.</p></li>
</ul>
</section>
<section id="optical-linear-algebra">
<h3>Optical linear algebra<a class="headerlink" href="#optical-linear-algebra" title="Permalink to this headline">#</a></h3>
<p>To overcome the mentioned limitations, we will study approaches to perform linear algebra calculations involving <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> only in the optical domain, i.e., without ever capturing the single elements of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>.</p>
</section>
<section id="light-paths">
<h3>Light paths<a class="headerlink" href="#light-paths" title="Permalink to this headline">#</a></h3>
<p>We again assume that all geometric structures involved in our imaging system are significantly larger than the wavelength of the employed light, so that the model of geometric optics, i.e., of light propagating along rays, is valid.</p>
<p>While travelling through the scene, light rays can be refracted, reflected, scattered, etc. until they either hit one of the camera’s pixels or get absorbed or exit the scene.</p>
<p>We denote a sequence of such light rays which connect a light source (i.e., a projector pixel) and a camera pixel as a <em>light path</em>.</p>
<p>Light paths can be categorized into <em>direct</em> and <em>indirect</em> paths.</p>
<img src="figures/4/light_path_categories.png" style="max-width:30vw"><ul class="simple">
<li><p><strong>Black ray - direct paths</strong>: From projector pixel to camera pixel via single scene point interaction.</p></li>
<li><p><strong>Indirect paths</strong>: Interaction with multiple scene points:</p>
<ul>
<li><p><strong>Red rays - diffuse indirect paths</strong>: Diffusely scatter at two or more diffuse points.</p></li>
<li><p><strong>Green rays - sepcular indirect paths</strong>: Diffusely scatter at most once.</p></li>
</ul>
</li>
</ul>
<p>Important: Since the area of a camera pixel is not infinitely small, it usually receives both, rays from direct and indirect light paths.</p>
<p>The image captured with the camera can be imagined as a superposition of multiple latent images, all corresponding to different kinds of light paths.</p>
<p>The reconstruction of these latent images is one major goal of light transport analysis.</p>
<p>They often reveal interesting properties of the scene.</p>
</section>
<section id="teaser">
<h3>Teaser<a class="headerlink" href="#teaser" title="Permalink to this headline">#</a></h3>
<p>We will see, how we</p>
<ul class="simple">
<li><p>can synthetically relight a scene, i.e., synthesize the image that would result when illuminating it with arbitrary illumination patterns (see previous example images),</p></li>
</ul>
<ul class="simple">
<li><p>can manipulate the image of a projector in order to compensate disturbing structures on the screen surface,</p></li>
</ul>
<ul class="simple">
<li><p>can separate direct an indirect light transport to obtain images dominated only by the respective optical effects.</p></li>
</ul>
<img src="figures/4/Example_Separation_Direct_Indirect.svg" style="max-width:30vw"></section>
<section id="entries-of-the-light-transport-matrix">
<h3>Entries of the light transport matrix<a class="headerlink" href="#entries-of-the-light-transport-matrix" title="Permalink to this headline">#</a></h3>
<p>Each entry of <span class="math notranslate nohighlight">\(\mathbf{T}[m,n]\)</span> describes the ratio of radiant energy that is transmitted from light source <span class="math notranslate nohighlight">\(n\)</span> to sensor element <span class="math notranslate nohighlight">\(m\)</span> via all optical paths that somehow connect source <span class="math notranslate nohighlight">\(n\)</span> and sensor element <span class="math notranslate nohighlight">\(m\)</span>:
<span class="math notranslate nohighlight">\(\begin{align} 
   T[m,n] = \int\limits_{\Omega_{m,n}} f(x) \mathrm{d} \mu (x)\,,
\end{align}\)</span>
with <span class="math notranslate nohighlight">\(\Omega_{m,n}\)</span> denoting the support, i.e., the space of light paths between source <span class="math notranslate nohighlight">\(n\)</span> and sensor element <span class="math notranslate nohighlight">\(m\)</span>, the scattering throughput function <span class="math notranslate nohighlight">\(f(x)\)</span> encoding the radiant energy transported along a light path <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(\mu (x)\)</span> representing the corresponding measure.</p>
<section id="helmholtz-reciprocity-principle">
<h4>Helmholtz reciprocity principle<a class="headerlink" href="#helmholtz-reciprocity-principle" title="Permalink to this headline">#</a></h4>
<p>For many practically relevant scenes, the scattering throughput scene can be assumed to obey the <em>Helmholtz reciprocity principle</em>, according to which the value of <span class="math notranslate nohighlight">\(f(x)\)</span> for a light path <span class="math notranslate nohighlight">\(x\)</span> does not depend on the propagation direction of the light rays of <span class="math notranslate nohighlight">\(x\)</span> (i.e., interchanging projector pixel <span class="math notranslate nohighlight">\(n\)</span> with camera pixel <span class="math notranslate nohighlight">\(m\)</span> would result in the same value for <span class="math notranslate nohighlight">\(T[m,n]\)</span>).</p>
</section>
</section>
</section>
<section id="light-transport-analysis-via-optical-computing">
<h2>Light transport analysis via optical computing<a class="headerlink" href="#light-transport-analysis-via-optical-computing" title="Permalink to this headline">#</a></h2>
<p>When illuminating the scene with an illumination vector <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>, capturing a camera image yields
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{i} = \mathbf{T}\mathbf{p} \,,
\end{align}\)</span>
i.e., the matrix multiplication <span class="math notranslate nohighlight">\(\mathbf{Tp}\)</span> has been performed in the optical domain.</p>
<p>This is the only possible way to interact with <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> in order to get information about it, i.e., via multiplying <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> with some vector <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> and observing the result <span class="math notranslate nohighlight">\(\mathbf{i}\)</span>.</p>
<p>Luckily, dealing with very large matrices like <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> only via matrix multiplication as stated before, represents a well-studied problem in the field of linear algebra.</p>
<p>Especially the set of so-called <em>Krylov subspace methods</em> is suitable for our case, which is why we will study some of these approaches in the following.</p>
<section id="optical-power-iteration">
<h3>Optical power iteration<a class="headerlink" href="#optical-power-iteration" title="Permalink to this headline">#</a></h3>
<p>We will first study a simple method to obtain the eigenvector <span class="math notranslate nohighlight">\(\mathbf{v}_1\)</span> of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> that corresponds to its largest eigenvalue <span class="math notranslate nohighlight">\(\lambda_1\)</span>. For this purpose, we will transform a method called <em>power iteration</em> into the optical domain.</p>
<p>The vector <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> is called the eigenvector of a square matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> if
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{Tv} = \lambda \mathbf{v} \,,
\end{align}\)</span>
with the so-called scalar eigenvalue <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
<p>The eigenvector <span class="math notranslate nohighlight">\(\mathbf{v}_1\)</span> that corresponds to the eigenvalue <span class="math notranslate nohighlight">\(\lambda_1\)</span> with the highest absolute value is called the <em>principal eigenvector</em>.</p>
<section id="power-iteration">
<h4>Power iteration<a class="headerlink" href="#power-iteration" title="Permalink to this headline">#</a></h4>
<p>Power iteration is a simple numerical algorithm for calculating the principal eigenvector of a square matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>. It exploits the fact the sequence
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{p}, \mathbf{Tp}, \mathbf{T}^2\mathbf{p}, \mathbf{T}^3\mathbf{p}, \ldots 
\end{align}\)</span>
converges to the principal eigenvector <span class="math notranslate nohighlight">\(\mathbf{v}_1\)</span> of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> for any initial vector <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>, that is not orthogonal to <span class="math notranslate nohighlight">\(\mathbf{v}_1\)</span>.</p>
</section>
<section id="implementation">
<h4>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">#</a></h4>
<p>The typical implementation looks like:</p>
<p><span class="math notranslate nohighlight">\(\mathbf{Function}\, \mathrm{powerIteration}(\mathbf{T})\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{p}_1 \leftarrow \text{ random vector}\)</span><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{for}\, k \in [1,\ldots,K]:\)</span><br><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}_k \leftarrow \mathbf{Tp}_k\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \frac{\mathbf{i}_k}{\left\| \mathbf{i}_k \right\|_2 }\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \textbf{return}\,  \mathbf{p}_{k+1}\)</span></p>
<p>The optical counterpart is given by:</p>
<p><span class="math notranslate nohighlight">\(\mathbf{Function}\, \mathrm{opticalPowerIteration}(\mathtt{camera},\, \mathtt{projector})\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{p}_1 \leftarrow \text{ random vector}\)</span><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{for}\, k \in [1,\ldots,K]:\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathtt{projector}.\text{project}(\mathbf{p}_k)\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}_k \leftarrow \mathtt{camera}.\text{acquireImage}()\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \frac{\mathbf{i}_k}{\left\| \mathbf{i}_k \right\|_2 }\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \textbf{return}\,  \mathbf{p}_{k+1}\)</span></p>
<p>Note that all elements of <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> have to be non-negative so that they can be projected onto the scene.</p>
<p>Some intermediate steps of an example optical power iteration application:</p>
<img src="figures/4/powerIteration_example.svg" style="max-width:30vw"></section>
<section id="limitations">
<h4>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Power iteration can only be applied to square matrices (i.e., for same sizes of projected images and captured images).</p></li>
</ul>
<ul class="simple">
<li><p>The convergence behavior of power iteration strongly depends on properties of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, especially on the similarity of the top two eigenvalues.</p></li>
</ul>
</section>
</section>
<section id="krylov-subspace-methods">
<h3>Krylov subspace methods<a class="headerlink" href="#krylov-subspace-methods" title="Permalink to this headline">#</a></h3>
<p>Krylov subspace methods represent a powerful family of algorithms for analyzing large sparse matrices <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> whose shape can be square or rectangular. All they need is to perform multiplications with <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> and sometimes with its transpose <span class="math notranslate nohighlight">\(\mathbf{T}\transp\)</span>.
<br>
Before we introduce the actual algorithms, we cover some prerequisites.</p>
<p>The Krylov subspace of dimension <span class="math notranslate nohighlight">\(k\)</span> is the span of vectors produced after <span class="math notranslate nohighlight">\(k\)</span> steps via power iteration, i.e.:
<span class="math notranslate nohighlight">\(\begin{align} 
   \left( \mathbf{p}_1 , \mathbf{p}_2 = \mathbf{Tp}, \mathbf{p}_3 = \mathbf{T}^2 \mathbf{p}_1 , \ldots , \mathbf{p}_{k+1} = \mathbf{T}^k \mathbf{p}_1 \right) \,.
\end{align}\)</span></p>
<section id="optical-matrix-vector-multiplication-for-arbitrary-vectors">
<h4>Optical matrix-vector multiplication for arbitrary vectors<a class="headerlink" href="#optical-matrix-vector-multiplication-for-arbitrary-vectors" title="Permalink to this headline">#</a></h4>
<p>Krylov subspace methods require to compute products with <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> for arbitrary vectors <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>, which may also contain negative values.</p>
<p>For this purpose, we express <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> as the difference between two non-negative vectors <span class="math notranslate nohighlight">\(\mathbf{p}^+\)</span> and <span class="math notranslate nohighlight">\(\mathbf{p}^-\)</span>:
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{p} &amp;= \mathbf{p}^+ - \mathbf{p}^- \\
   \mathbf{Tp} &amp;= \mathbf{Tp}^+ - \mathbf{Tp}^- \,.
\end{align}\)</span></p>
<p>As a result, we have to project and capture two images to achieve an optical realization of these kinds of matrix-vector multiplications.</p>
</section>
<section id="symmetry-of-transport-matrix">
<h4>Symmetry of transport matrix<a class="headerlink" href="#symmetry-of-transport-matrix" title="Permalink to this headline">#</a></h4>
<p>Only for symmetric matrices the convergence characteristics of Krylov subspace is well-understood and promises fast convergence. Hence, we stick to that case and ensure optically that the light transport matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> is symmetric.</p>
<section id="enforcing-symmetry-for-mathbf-t">
<h5>Enforcing symmetry for <span class="math notranslate nohighlight">\(\mathbf{T}\)</span><a class="headerlink" href="#enforcing-symmetry-for-mathbf-t" title="Permalink to this headline">#</a></h5>
<p>By using a coaxial camera-projector arrangement and equal resolutions for both components, the symmetry of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> can be guaranteed due to Helmholtz reciprocity (see the following figure).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interact</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">showFig</span><span class="p">(</span><span class="s1">&#39;figures/4/symmetric_transport_matrix_&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;.svg&#39;</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="p">(</span><span class="n">min_i</span><span class="o">:=</span><span class="mi">1</span><span class="p">),</span><span class="nb">max</span><span class="o">=</span><span class="p">(</span><span class="n">max_i</span><span class="o">:=</span><span class="mi">7</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="n">max_i</span> <span class="k">if</span> <span class="n">book</span> <span class="k">else</span> <span class="n">min_i</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "eb3ff299caac48ecb9d780bccd170a9a"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.&lt;lambda&gt;(i)&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="low-rank-approximation-of-mathbf-t-via-optical-arnoldi">
<h4>Low-rank approximation of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> via optical Arnoldi<a class="headerlink" href="#low-rank-approximation-of-mathbf-t-via-optical-arnoldi" title="Permalink to this headline">#</a></h4>
<p>In its <span class="math notranslate nohighlight">\(k\)</span>-th iteration, the Arnoldi method allows to calculate the top <span class="math notranslate nohighlight">\(k\)</span> eigenvectors (or singular vectors) of a matrix.</p>
<p>It calculates a sequence of orthogonal vectors <span class="math notranslate nohighlight">\(\mathbf{p}_1, \ldots, \mathbf{p}_k\)</span> whose span is an approximation of the span of the top <span class="math notranslate nohighlight">\(k\)</span> eigenvectors of the matrix under investigation.</p>
<p>The accuracy of the approximation increases with <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\mathbf{Function}\, \mathrm{opticalSymmetricArnoldi}(\mathtt{camera},\, \mathtt{projector})\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{p}_1 \leftarrow \text{ non-zero random vector}\)</span><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{for}\, k \in [1,\ldots,K]:\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathtt{projector}.\text{project}(\mathbf{p}^+_k)\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}^+_k \leftarrow \mathtt{camera}.\text{acquireImage}()\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathtt{projector}.\text{project}(\mathbf{p}^-_k)\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}^-_k \leftarrow \mathtt{camera}.\text{acquireImage}()\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}_k \leftarrow i^+_k - i^-_k\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \text{ortho}(\mathbf{p}_1, \ldots ,\mathbf{p}_k,\mathbf{i}_k)\)</span>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \frac{\mathbf{p}_{k+1}}{\left\| \mathbf{p}_{k+1} \right\|_2 }\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \textbf{return}\,  \left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]\transp  \)</span></p>
<p>The function <span class="math notranslate nohighlight">\(\text{ortho}(\mathbf{p}_1, \ldots ,\mathbf{p}_k,\mathbf{i}_k)\)</span> projects its last argument <span class="math notranslate nohighlight">\(\mathbf{i}_k\)</span> onto the subspace orthogonal to the columns of the matrix <span class="math notranslate nohighlight">\(\mathbf{P} = [\mathbf{p}_1, \mathbf{p}_2, \ldots, \mathbf{p}_k]\)</span>, i.e.,
<span class="math notranslate nohighlight">\(\begin{align} 
  \text{ortho}(\mathbf{p}_1, \ldots ,\mathbf{p}_k,\mathbf{i}_k) = \mathbf{i}_k - \mathbf{P}\left( \mathbf{P}\transp \mathbf{P} \right)^{-1}  \mathbf{P}\transp \mathbf{i}_k
\end{align}\)</span></p>
<p>The Arnoldi algorithm constructs an orthogonal basis <span class="math notranslate nohighlight">\(\left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]\)</span> for the subspace of illumination vectors and a basis <span class="math notranslate nohighlight">\(\left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right]\)</span> for the subspace of acquired images. The product <span class="math notranslate nohighlight">\(\left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]\transp\)</span> is a low-rank approximation of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>.</p>
<p>In order to synthetically relight the scene with an arbitrary illumination <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>, the following expression has to be evaluated:
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{Tp} \approx \left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]\transp \mathbf{p} \,.
\end{align}\)</span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If this equation is successively evaluated from right to left, at no time a matrix larger than <span class="math notranslate nohighlight">\(K \times N\)</span> has to be kept in memory.</p>
</div>
</section>
<section id="optical-matrix-inversion-via-gmres">
<h4>Optical matrix inversion via GMRES<a class="headerlink" href="#optical-matrix-inversion-via-gmres" title="Permalink to this headline">#</a></h4>
<p>We now assume that we are given a camera image <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> of our scene and want to obtain the illumination <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> that produced it, i.e., we want to find
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{p} = \argmin{\mathbf{x}} \left\| \left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]\transp \mathbf{x} - \mathbf{i} \right\|_2 \,. 
\end{align}\)</span></p>
<p>This optimization problem can be solved via the Moore-Penrose pseudoinverse <span class="math notranslate nohighlight">\(\mathbf{T}^\dagger\)</span> of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> (in order to account for a potentially singular matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>):
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{p} = \mathbf{T}^\dagger \mathbf{i}\,.
\end{align}\)</span></p>
<p>This solution can also be calculated optically via another popular Krylov subspace method called <em>generalized minimum residual (GMRES)</em> that also only relies on computing products with <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> and does not need to access to the complete matrix.</p>
<p>The algorithm differs only slightly from optical Arnoldi, namely</p>
<ul class="simple">
<li><p>in the initialization vector <span class="math notranslate nohighlight">\(\mathbf{p}_1\)</span>, which is always the target image <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> and</p></li>
<li><p>in the return value, which is <span class="math notranslate nohighlight">\(\left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]^\dagger \mathbf{i}\)</span>, i.e., the approximation of the sought illumination vector.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\mathbf{Function}\, \mathrm{opticalSymmetricGMRES}(\mathtt{camera},\, \mathtt{projector}, \mathbf{i})\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{p}_1 \leftarrow \mathbf{i}\)</span><br>
<span class="math notranslate nohighlight">\(\quad \mathbf{for}\, k \in [1,\ldots,K]:\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathtt{projector}.\text{project}(\mathbf{p}^+_k)\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}^+_k \leftarrow \mathtt{camera}.\text{acquireImage}()\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathtt{projector}.\text{project}(\mathbf{p}^-_k)\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}^-_k \leftarrow \mathtt{camera}.\text{acquireImage}()\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{i}_k \leftarrow i^+_k - i^-_k\)</span><br>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \text{ortho}(\mathbf{p}_1, \ldots ,\mathbf{p}_k,\mathbf{i}_k)\)</span>
<span class="math notranslate nohighlight">\(\qquad \mathbf{p}_{k+1} \leftarrow \frac{\mathbf{p}_{k+1}}{\left\| \mathbf{p}_{k+1} \right\|_2 }\)</span><br><br>
<span class="math notranslate nohighlight">\(\quad \textbf{return}\,  \left[ \mathbf{i}_1 \cdots \mathbf{i}_{K} \right] \left[ \mathbf{p}_1 \cdots \mathbf{p}_K  \right]^\dagger \mathbf{i}  \)</span></p>
<p>Intuitively, GMRES calculates a rank-<span class="math notranslate nohighlight">\(K\)</span> approximation of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> and calculates its pseudoinverse to solve for <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>. The initialization of <span class="math notranslate nohighlight">\(\mathbf{p}_1\)</span> with <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> helps to explore only a portion of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>’s row space that is suitable for the inversion with respect to <span class="math notranslate nohighlight">\(\mathbf{i}\)</span>.</p>
<section id="example-experiments">
<h5>Example experiments<a class="headerlink" href="#example-experiments" title="Permalink to this headline">#</a></h5>
<img src="figures/4/result_GMRES.svg" style="max-width:30vw"></section>
</section>
</section>
</section>
<section id="primal-dual-coding-for-optical-probing">
<h2>Primal-Dual coding for optical probing<a class="headerlink" href="#primal-dual-coding-for-optical-probing" title="Permalink to this headline">#</a></h2>
<p><em>Optical probing</em> can be seen as the optical implementation of <em>matrix probing</em>, a topic of numerical mathematics dealing with the efficient estimation of special regions of interest of very large matrices (like <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>), e.g., its trace or diagonal.</p>
<p>Optical probing allows to obtain certain latent images of the scene which are normally hidden in the global light transport.</p>
<p>For example, it is possible to obtain images corresponding to either (approximately) only direct or (approximately) only indirect light transport. Such images can reveal interesting insights about the observed scene (e.g., the structure of the blood vessels under the skin).</p>
<p>Optical probing can be mathematically modelled as
<span class="math notranslate nohighlight">\(\begin{align} 
   \mathbf{i} = \left( \boldsymbol{\Pi} \odot \mathbf{T} \right) \mathbf{1} \,,
\end{align}\)</span>
with <span class="math notranslate nohighlight">\(\boldsymbol{\Pi}\)</span> denoting the <em>probing matrix</em> and <span class="math notranslate nohighlight">\(\odot\)</span> denoting the element-wise product between two matrices of equal size, <span class="math notranslate nohighlight">\(\mathbf{1}\)</span> denoting a vector of all ones representing a uniform illumination and finally <span class="math notranslate nohighlight">\(\mathbf{i}\)</span> representing the image captured under uniform illumination and for a light transport matrix that is the result of <span class="math notranslate nohighlight">\(\boldsymbol{\Pi} \odot \mathbf{T}\)</span>.</p>
<p>In order to be able to manipulate <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> in this way, it is necessary to control two aspects of the image formation process:</p>
<ul class="simple">
<li><p>the illumination, the so-called <em>primal domain</em> via the projected image and</p></li>
<li><p>the pixel-wise modulation of the camera’s sensor, the so-called <em>dual domain</em>.</p></li>
</ul>
<p>Control of the dual domain is possible by</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Generate synth. LTM</span>
<span class="n">SIZE</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">RANK</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">LTM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">SIZE</span><span class="p">,</span><span class="n">RANK</span><span class="p">)</span><span class="nd">@np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">RANK</span><span class="p">,</span><span class="n">SIZE</span><span class="p">)</span>
<span class="n">LTM</span> <span class="o">=</span> <span class="n">LTM</span> <span class="o">+</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">SIZE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_ITERATIONS</span> <span class="o">=</span> <span class="mi">128</span><span class="c1">#1024     # Number of Arnoldi iterations</span>
<span class="n">NUM_ITERATIONS_STEP</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Only reconstruct matrix every </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;Green.mat&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LTM&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># For converting to a NumPy array</span>
<span class="n">LTM</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">NUM_ITERATIONS</span> <span class="o">=</span> <span class="mi">1024</span>     <span class="c1"># Number of Arnoldi iterations</span>
<span class="n">NUM_ITERATIONS_STEP</span> <span class="o">=</span> <span class="mi">32</span>   <span class="c1"># Only reconstruct matrix every </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">b77b20a38d3c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">h5py</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;Green.mat&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LTM&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># For converting to a NumPy array</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">LTM</span> <span class="o">=</span> <span class="n">data</span>

<span class="nn">~\repos\vlcompimg\compimg\lib\site-packages\h5py\_hl\files.py</span> in <span class="ni">__init__</span><span class="nt">(self, name, mode, driver, libver, userblock_size, swmr, rdcc_nslots, rdcc_nbytes, rdcc_w0, track_order, fs_strategy, fs_persist, fs_threshold, fs_page_size, page_buf_size, min_meta_keep, min_raw_keep, locking, alignment_threshold, alignment_interval, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">531</span>                                  <span class="n">fs_persist</span><span class="o">=</span><span class="n">fs_persist</span><span class="p">,</span> <span class="n">fs_threshold</span><span class="o">=</span><span class="n">fs_threshold</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">532</span>                                  <span class="n">fs_page_size</span><span class="o">=</span><span class="n">fs_page_size</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">533</span>                 <span class="n">fid</span> <span class="o">=</span> <span class="n">make_fid</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">userblock_size</span><span class="p">,</span> <span class="n">fapl</span><span class="p">,</span> <span class="n">fcpl</span><span class="p">,</span> <span class="n">swmr</span><span class="o">=</span><span class="n">swmr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">534</span> 
<span class="g g-Whitespace">    </span><span class="mi">535</span>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">libver</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

<span class="nn">~\repos\vlcompimg\compimg\lib\site-packages\h5py\_hl\files.py</span> in <span class="ni">make_fid</span><span class="nt">(name, mode, userblock_size, fapl, fcpl, swmr)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span>         <span class="k">if</span> <span class="n">swmr</span> <span class="ow">and</span> <span class="n">swmr_support</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span>             <span class="n">flags</span> <span class="o">|=</span> <span class="n">h5f</span><span class="o">.</span><span class="n">ACC_SWMR_READ</span>
<span class="ne">--&gt; </span><span class="mi">226</span>         <span class="n">fid</span> <span class="o">=</span> <span class="n">h5f</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">fapl</span><span class="o">=</span><span class="n">fapl</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>     <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r+&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>         <span class="n">fid</span> <span class="o">=</span> <span class="n">h5f</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">h5f</span><span class="o">.</span><span class="n">ACC_RDWR</span><span class="p">,</span> <span class="n">fapl</span><span class="o">=</span><span class="n">fapl</span><span class="p">)</span>

<span class="nn">h5py\_objects.pyx</span> in <span class="ni">h5py._objects.with_phil.wrapper</span><span class="nt">()</span>

<span class="nn">h5py\_objects.pyx</span> in <span class="ni">h5py._objects.with_phil.wrapper</span><span class="nt">()</span>

<span class="nn">h5py\h5f.pyx</span> in <span class="ni">h5py.h5f.open</span><span class="nt">()</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] Unable to open file (unable to open file: name = &#39;Green.mat&#39;, errno = 2, error message = &#39;No such file or directory&#39;, flags = 0, o_flags = 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="p">,</span><span class="n">N</span> <span class="o">=</span> <span class="n">LTM</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">right_Arnoldi_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">NUM_ITERATIONS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">right_Arnoldi_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">:=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">left_Arnoldi_vectors</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span><span class="p">,</span><span class="n">NUM_ITERATIONS</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NUM_ITERATIONS</span><span class="p">):</span>
    
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">LTM</span><span class="nd">@right_Arnoldi_vectors</span><span class="p">[:,</span><span class="n">k</span><span class="p">];</span>    
    <span class="n">left_Arnoldi_vectors</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
    
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">LTM</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="nd">@left_Arnoldi_vectors</span><span class="p">[:,</span><span class="n">k</span><span class="p">];</span>
    <span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">right_Arnoldi_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="nd">@right_Arnoldi_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">right_Arnoldi_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="nd">@tmp</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">inv</span> <span class="o">@</span> <span class="n">right</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">right_Arnoldi_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">@</span> <span class="n">right</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">-</span> <span class="n">right</span>
    <span class="c1">#tmp = tmp - right_Arnoldi_vectors[:,0:k+1] @ inv @right_Arnoldi_vectors[:,0:k+1].transpose()@tmp</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>

    <span class="n">right_Arnoldi_vectors</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">optArnoldi</span><span class="p">(</span><span class="n">NUM_ITERATIONS</span><span class="p">,</span> <span class="n">LTM</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_ITERATIONS</span><span class="p">,</span> <span class="n">NUM_ITERATIONS_STEP</span><span class="p">):</span>
    <span class="n">LTM_approx</span> <span class="o">=</span> <span class="n">left_Arnoldi_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="nd">@right_Arnoldi_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="c1">#errors.append(np.linalg.norm(LTM - LTM_approx) / np.linalg.norm(LTM))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LTM</span><span class="o">-</span><span class="n">LTM_approx</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_ITERATIONS</span><span class="p">,</span> <span class="n">NUM_ITERATIONS_STEP</span><span class="p">):</span>
    <span class="n">LTM_approx</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="nd">@b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="c1">#LTM_approx = b[0,0:k+1]@a[0,0:k+1].transpose()</span>
    <span class="c1">#errors2.append(np.linalg.norm(LTM - LTM_approx) / np.linalg.norm(LTM))</span>
    <span class="n">errors2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LTM</span><span class="o">-</span><span class="n">LTM_approx</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">LTM</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="nd">@LTM</span>
<span class="n">U</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">right_singular_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

<span class="n">left_singular_vectors</span> <span class="o">=</span> <span class="n">LTM</span><span class="nd">@right_singular_vectors</span>

<span class="n">errors3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_ITERATIONS</span><span class="p">,</span> <span class="n">NUM_ITERATIONS_STEP</span><span class="p">):</span>
    <span class="n">LTM_approx</span> <span class="o">=</span> <span class="n">left_singular_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="nd">@right_singular_vectors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="c1">#errors2.append(np.linalg.norm(LTM - LTM_approx) / np.linalg.norm(LTM))</span>
    <span class="n">errors3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LTM</span><span class="o">-</span><span class="n">LTM_approx</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optArnoldi</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1">#p[:,0] = np.random.rand(A.shape[1])</span>
    <span class="n">p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">:=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K</span><span class="p">):</span>
        <span class="n">i</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@p</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#print(P.shape)</span>
        <span class="c1">#print(P)</span>
        <span class="n">p</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">@</span> <span class="n">P</span><span class="p">)</span><span class="nd">@P</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="nd">@i</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">classicArnoldi</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">:=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">V</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="nd">@V</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span> <span class="n">V</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">moep</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@V</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">moep</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">W</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@V</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp</span>
        <span class="n">H</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">W</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">H</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;moep&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">V</span><span class="p">[:,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">H</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">V</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K2</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">classicArnoldi</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span> <span class="n">LTM</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LTM_approx</span> <span class="o">=</span> <span class="n">v</span><span class="nd">@h@v</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors4</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
    <span class="n">LTM_approx</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="nd">@h</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="nd">@v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">errors4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LTM</span><span class="o">-</span><span class="n">LTM_approx</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LTM</span><span class="o">-</span><span class="n">LTM_approx</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "compimg"
        },
        kernelOptions: {
            kernelName: "compimg",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'compimg'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="03_LightFieldMethods.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Light Field Methods</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="05_InverseProblemsInCompimg.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inverse Problems in Computational Imaging</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dr.-Ing. Johannes Meyer<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>