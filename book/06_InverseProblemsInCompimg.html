
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Inverse Problems in Computational Imaging &#8212; Computational Imaging - Course Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Neural Networks for Computational Imaging" href="05_NeuralNetworksForCompImg.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Computational Imaging - Course Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Computational Imaging - Course Notes for Winter Term 2022 / 2023
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_Basics.html">
   Fundamental Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_LightFieldMethods.html">
   Light Field Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_LightTransportAnalysis.html">
   Light Transport Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_NeuralNetworksForCompImg.html">
   Neural Networks for Computational Imaging
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Inverse Problems in Computational Imaging
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/06_InverseProblemsInCompimg.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/06_InverseProblemsInCompimg.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#content">
   Content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-into-inverse-problems">
   Introduction into inverse problems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#image-deconvolution">
   Image deconvolution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#duality-between-signal-processing-perspective-and-algebraic-perspective">
     Duality between signal processing perspective and algebraic perspective
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-filter">
     Inverse filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wiener-filter">
     Wiener filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#richardson-lucy">
     Richardson-Lucy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-based-methods">
     Optimization-based methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bayesian-perspective-of-inverse-problems">
       Bayesian perspective of inverse problems
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#total-variation">
         Total Variation
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#half-quadratic-splitting-hqs-method">
       Half-quadratic splitting (HQS) method
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#hqs-for-deconvolution">
         HQS for deconvolution
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#hqs-with-total-variation-and-denoising-regularizers">
           HQS with total variation and denoising regularizers
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#efficient-implementation-of-x-update">
           Efficient implementation of
           <span class="math notranslate nohighlight">
            \(x\)
           </span>
           -update
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#special-case-of-total-variation-regularizer">
           Special case of total variation regularizer
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#general-regularizer">
           General regularizer
          </a>
         </li>
        </ul>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#efficient-implementation-of-z-update-for-anisotropic-tv-regularizer">
         Efficient implementation of
         <span class="math notranslate nohighlight">
          \(z\)
         </span>
         -update for anisotropic TV regularizer
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#visualization-of-soft-thresholding-operator">
         Visualization of soft thresholding operator
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#efficient-implementation-of-z-update-for-isotropic-tv-regularizer">
         Efficient implementation of
         <span class="math notranslate nohighlight">
          \(z\)
         </span>
         -update for isotropic TV regularizer
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Inverse Problems in Computational Imaging</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#content">
   Content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-into-inverse-problems">
   Introduction into inverse problems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#image-deconvolution">
   Image deconvolution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#duality-between-signal-processing-perspective-and-algebraic-perspective">
     Duality between signal processing perspective and algebraic perspective
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-filter">
     Inverse filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wiener-filter">
     Wiener filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#richardson-lucy">
     Richardson-Lucy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-based-methods">
     Optimization-based methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bayesian-perspective-of-inverse-problems">
       Bayesian perspective of inverse problems
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#total-variation">
         Total Variation
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#half-quadratic-splitting-hqs-method">
       Half-quadratic splitting (HQS) method
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#hqs-for-deconvolution">
         HQS for deconvolution
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#hqs-with-total-variation-and-denoising-regularizers">
           HQS with total variation and denoising regularizers
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#efficient-implementation-of-x-update">
           Efficient implementation of
           <span class="math notranslate nohighlight">
            \(x\)
           </span>
           -update
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#special-case-of-total-variation-regularizer">
           Special case of total variation regularizer
          </a>
         </li>
         <li class="toc-h6 nav-item toc-entry">
          <a class="reference internal nav-link" href="#general-regularizer">
           General regularizer
          </a>
         </li>
        </ul>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#efficient-implementation-of-z-update-for-anisotropic-tv-regularizer">
         Efficient implementation of
         <span class="math notranslate nohighlight">
          \(z\)
         </span>
         -update for anisotropic TV regularizer
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#visualization-of-soft-thresholding-operator">
         Visualization of soft thresholding operator
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#efficient-implementation-of-z-update-for-isotropic-tv-regularizer">
         Efficient implementation of
         <span class="math notranslate nohighlight">
          \(z\)
         </span>
         -update for isotropic TV regularizer
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%js</span>
<span class="nx">Jupyter</span><span class="p">.</span><span class="nx">notebook</span><span class="p">.</span><span class="nx">get_cell</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">element</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">Jupyter.notebook.get_cell(0).element.hide()
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sig</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simpson</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">HTML</span>
<span class="o">%</span><span class="k">matplotlib</span> notebook
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\meyjoh\repos\vlcompimg\compimg\lib\site-packages\scipy\__init__.py:138: UserWarning: A NumPy version &gt;=1.16.5 and &lt;1.23.0 is required for this version of SciPy (detected version 1.23.4)
  warnings.warn(f&quot;A NumPy version &gt;={np_minversion} and &lt;{np_maxversion} is required for this version of &quot;
</pre></div>
</div>
</div>
</div>
<p>LaTeX-macros:
<span class="math notranslate nohighlight">\(\begin{align}
  \newcommand{transp}{^\intercal}
  \newcommand{F}{\mathcal{F}}
  \newcommand{Fi}{\mathcal{F}^{-1}}
  \newcommand{inv}{^{-1}}
  \newcommand{stochvec}[1]{\mathbf{\tilde{#1}}}
  \newcommand{argmax}{\mathrm{arg\, max}}
\end{align}\)</span></p>
<p>LaTeX command stochvec:
<span class="math notranslate nohighlight">\(\newcommand{stochvec}[1]{\mathbf{\tilde{#1}}}\)</span>
<br>
LaTeX command transp:
<span class="math notranslate nohighlight">\(\newcommand{transp}{^\intercal}\)</span>
LaTeX command argmax:
<span class="math notranslate nohighlight">\(\newcommand{argmax}[1]{\underset{#1}{\mathrm{arg\, max}}}\)</span>
LaTeX command argmin:
<span class="math notranslate nohighlight">\(\newcommand{argmin}[1]{\underset{#1}{\mathrm{arg\, min}}}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%javascript</span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
    <span class="nx">TeX</span><span class="o">:</span> <span class="p">{</span> <span class="nx">equationNumbers</span><span class="o">:</span> <span class="p">{</span> <span class="nx">autoNumber</span><span class="o">:</span> <span class="s2">&quot;AMS&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%javascript</span>

<span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Queue</span><span class="p">(</span>
  <span class="p">[</span><span class="s2">&quot;resetEquationNumbers&quot;</span><span class="p">,</span> <span class="nx">MathJax</span><span class="p">.</span><span class="nx">InputJax</span><span class="p">.</span><span class="nx">TeX</span><span class="p">],</span>
  <span class="p">[</span><span class="s2">&quot;PreProcess&quot;</span><span class="p">,</span> <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">],</span>
  <span class="p">[</span><span class="s2">&quot;Reprocess&quot;</span><span class="p">,</span> <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
MathJax.Hub.Queue(
  ["resetEquationNumbers", MathJax.InputJax.TeX],
  ["PreProcess", MathJax.Hub],
  ["Reprocess", MathJax.Hub]
);
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showFig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ending</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">IFrame</span><span class="p">(</span><span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">ending</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showFig2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ending</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="n">imgToShow</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}{</span><span class="n">i</span><span class="si">}{</span><span class="n">ending</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgToShow</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showFig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ending</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="c1">#return SVG(filename = &quot;./&quot; + path+str(i)+ending)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">ending</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showFig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ending</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">ending</span>
    <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span>  <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">/&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">imshow2</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1">#plt.close(&#39;all&#39;)</span>
    <span class="c1">#plt.figure()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#interact(lambda i: showFig(&#39;figures/2/dftSpectrum_&#39;,i,&#39;.svg&#39;,800,700), i=widgets.IntSlider(min=1,max=3, step=1, value=1))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#&lt;img src=&quot;figures/2/pinholePrinciple.svg&quot; style=&quot;width:40vw&quot;&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interact</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">showFig2</span><span class="p">(</span><span class="s1">&#39;figures/3/lfSAIs/out_09_&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">1100</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "c5148f88e7264e97b168f5041ac41784"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.&lt;lambda&gt;(i)&gt;
</pre></div>
</div>
</div>
</div>
<img src="figures/3/SchlierenDeflectometer.svg" style="max-height:40vh"><section class="tex2jax_ignore mathjax_ignore" id="inverse-problems-in-computational-imaging">
<h1>Inverse Problems in Computational Imaging<a class="headerlink" href="#inverse-problems-in-computational-imaging" title="Permalink to this headline">#</a></h1>
<p><font size="7"> Computational Imaging </font><br><br><br>
<font size="5"> Chapter 5: Inverse Problems in Computational Imaging </font></p>
<section id="content">
<h2>Content<a class="headerlink" href="#content" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Introduction into inverse problems</p>
<ul>
<li><p>What are inverse problems?</p></li>
<li><p>Approaches for solving inverse problems</p></li>
</ul>
</li>
<li><p>Image deconvolution</p>
<ul>
<li><p>Inverse filter</p></li>
<li><p>Wiener filter (classical) and its problems</p></li>
<li><p>Richardson-Lucy</p></li>
<li><p>Optimization-based</p>
<ul>
<li><p>Half-quadratic Splitting</p></li>
</ul>
</li>
<li><p>Deep SNR-estimation for Wiener filter</p></li>
<li><p>ADMM</p></li>
</ul>
</li>
</ul>
</section>
<section id="introduction-into-inverse-problems">
<h2>Introduction into inverse problems<a class="headerlink" href="#introduction-into-inverse-problems" title="Permalink to this headline">#</a></h2>
</section>
<section id="image-deconvolution">
<h2>Image deconvolution<a class="headerlink" href="#image-deconvolution" title="Permalink to this headline">#</a></h2>
<p>Image deconvolution deals with the problem of recovering an original image <span class="math notranslate nohighlight">\(x\)</span> after it has been convolved with a kernel <span class="math notranslate nohighlight">\(c\)</span> and has been affected by some additive noise <span class="math notranslate nohighlight">\(n\)</span>.<br> Hence, the image formation model can be expressed via:
<span class="math notranslate nohighlight">\(\begin{align}\label{eq:img_formation}
    b=c*x + n\,,
\end{align}\)</span>
with <span class="math notranslate nohighlight">\(b\)</span> denoting the observed image.</p>
<p><br> Note: The dependence on a spatial variable (e.g., like <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> for <span class="math notranslate nohighlight">\(g(\mathbf{x})\)</span>) is omitted for this chapter for the sake of clarity.</p>
<p>The task is to find an <span class="math notranslate nohighlight">\(\hat{x}\)</span> that is as close to the original <span class="math notranslate nohighlight">\(x\)</span> as possible.</p>
<p>Methods and approaches dealing with deconvolution can be divided into two groups:</p>
<ol class="simple">
<li><p><em>Blind</em> deconvolution: The kernel <span class="math notranslate nohighlight">\(c\)</span> is assumed to be unknown and also has to be recovered / estimated.</p></li>
<li><p><em>Non-blind</em> deconvolution: The kernel <span class="math notranslate nohighlight">\(c\)</span> is assumed to be known.</p></li>
</ol>
<p><br>Note that there is some research which focuses on estimating the kernel <span class="math notranslate nohighlight">\(c\)</span> and then employs non-blind deconvolution methods to perform the deconvolution.</p>
<p>According to the convolution theorem of the Fourier transform, equation <span class="math notranslate nohighlight">\(\eqref{eq:img_formation}\)</span> can be expressed as:
<span class="math notranslate nohighlight">\(\begin{align}\label{eq:img_formation_fourier}
    b = \mathcal{F}^{-1}\lbrace \mathcal{F} \lbrace c \rbrace \cdot \mathcal{F} \lbrace x \rbrace \rbrace + n
\end{align}\)</span></p>
<p><strong>Important note:</strong> Equations <span class="math notranslate nohighlight">\(\eqref{eq:img_formation}\)</span> and <span class="math notranslate nohighlight">\(\eqref{eq:img_formation_fourier}\)</span> only result in the same numbers, if the convolution is performed with ciruclar boundary conditions, i.e., when the convolution kernel wraps around the image borders.</p>
<section id="duality-between-signal-processing-perspective-and-algebraic-perspective">
<h3>Duality between signal processing perspective and algebraic perspective<a class="headerlink" href="#duality-between-signal-processing-perspective-and-algebraic-perspective" title="Permalink to this headline">#</a></h3>
<p>Since the convolution is a linear operator, it can also be expressed in terms of a matrix vector multiplication:
<span class="math notranslate nohighlight">\(\begin{align}\label{eq:duality}
    b = c*x \Leftrightarrow \mathbf{b} = \mathbf{C}\mathbf{x}\,,
\end{align}\)</span>
with a square circulant Toeplitz matrix <span class="math notranslate nohighlight">\(\mathbf{C}\in \mathbb{R}^{N\times N}\)</span> implementing the convolution and <span class="math notranslate nohighlight">\(\mathbf{x,b} \in \mathbb{R}^N\)</span> representing the vectorized forms of the corresponding images <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.</p>
</section>
<section id="inverse-filter">
<h3>Inverse filter<a class="headerlink" href="#inverse-filter" title="Permalink to this headline">#</a></h3>
<p>The inverse filter represents the straightforward approach of solving equation <span class="math notranslate nohighlight">\(\eqref{eq:img_formation_fourier}\)</span> for <span class="math notranslate nohighlight">\(x\)</span> while neglecting the noise <span class="math notranslate nohighlight">\(n\)</span>:
<span class="math notranslate nohighlight">\(\begin{align}\label{eq:inv_filter}
        \hat{x}_{\mathrm{inv}}=\Fi\left\lbrace \frac{\F\lbrace b \rbrace}{\F\lbrace c \rbrace } \right\rbrace \,.
\end{align}\)</span></p>
<p>Properties of the inverse filter:</p>
<ul class="simple">
<li><p>computationally efficient,</p></li>
<li><p>problematic for small values of <span class="math notranslate nohighlight">\(\F \lbrace c \rbrace\)</span>, (amplifies noise).</p></li>
</ul>
<p>Unfortunately, the second point is true for most practically relevant point spread functions.</p>
<p>TODO: Example images.</p>
<p>EXERCISE: Implement inverse filter and do some tests for varying noise levels.</p>
</section>
<section id="wiener-filter">
<h3>Wiener filter<a class="headerlink" href="#wiener-filter" title="Permalink to this headline">#</a></h3>
<p>TBD</p>
</section>
<section id="richardson-lucy">
<h3>Richardson-Lucy<a class="headerlink" href="#richardson-lucy" title="Permalink to this headline">#</a></h3>
<p>TBD</p>
</section>
<section id="optimization-based-methods">
<h3>Optimization-based methods<a class="headerlink" href="#optimization-based-methods" title="Permalink to this headline">#</a></h3>
<p>As stated before, deconvolution is an ill-posed problems, i.e., usually there are infinitely many solutions which satisfy the measurements.</p>
<p><span class="math notranslate nohighlight">\(\Rightarrow\)</span> One needs an instrument to determine how desirable a given solution is.</p>
<section id="bayesian-perspective-of-inverse-problems">
<h4>Bayesian perspective of inverse problems<a class="headerlink" href="#bayesian-perspective-of-inverse-problems" title="Permalink to this headline">#</a></h4>
<p>General formulation of an inverse problem:
<span class="math notranslate nohighlight">\(\begin{align}
    \mathbf{b}=\mathbf{A}\mathbf{x} + \mathbf{n}\,,
\end{align}\)</span>
with <span class="math notranslate nohighlight">\(\mathbf{x}\in \mathbb{R}^N, \mathbf{b,n}\in \mathbb{R}^M, \mathbf{A}\in \mathbb{R}^{M\times N}\)</span>.</p>
<p>Interpret as random vectors:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\stochvec{x}\sim \mathcal{N}(\mathbf{x},0)\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\stochvec{n}\sim \mathcal{N}(0,\sigma^2)\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\( \stochvec{b}\sim \mathcal{N}((\mathbf{Ax}),\sigma^2)\)</span></p></li>
</ul>
<p>For probability of observation <span class="math notranslate nohighlight">\( \mathbf{b}\)</span> it holds:
<span class="math notranslate nohighlight">\(\begin{align}
    p( \mathbf{b}\vert \mathbf{x}, \sigma) \propto \exp \left( - \frac{\Vert \mathbf{b} - \mathbf{Ax} \Vert^2_2}{2\sigma^2} \right)
\end{align}
\)</span></p>
<p>According to Bayes’ rule:
<span class="math notranslate nohighlight">\(\begin{align}
    \underbrace{p(\mathbf{x}\vert \mathbf{b},\sigma)}_{\mathrm{posterior}} = \frac{p( \mathbf{b}\vert \mathbf{x}, \sigma)\cdot p( \mathbf{x})}{p( \mathbf{b})} \propto \underbrace{p( \mathbf{b} \vert \mathbf{x}, \sigma)}_{\mathrm{image\ formation\ model}} \cdot \underbrace{p( \mathbf{x})}_{prior}\,.
\end{align}
\)</span></p>
<p>Maximum-a-posteriori (MAP) solution:
<span class="math notranslate nohighlight">\(\begin{align}
  \hat{x}_\mathrm{MAP} &amp;= \argmax{\mathbf{x}}\, p(\mathbf{x}\vert \mathbf{b},\sigma) \\
                         &amp;= \argmax{\mathbf{x}}\, \log p(\mathbf{x}\vert \mathbf{b},\sigma) \\
                         &amp;= \argmin{ \mathbf{x}}\, - \log p(\mathbf{x}\vert \mathbf{b},\sigma) \\
                         &amp;= \argmin{ \mathbf{x}}\, - \log p( \mathbf{b} \vert \mathbf{x}, \sigma) - \log p( \mathbf{x}) \\
                         \label{eq:map_solution}&amp;= \argmin{ \mathbf{x}}\, \underbrace{\frac{\Vert \mathbf{b} - \mathbf{Ax} \Vert^2_2}{2\sigma^2}}_{\mathrm{data\, fidelity\, term}} + \underbrace{\Psi(\mathbf{x})}_{ \mathrm{regularizer}}\,.                         
\end{align}
\)</span></p>
<p>The choice of image priors / regularizers depends on the imaging task, i.e., the nature of the images that are to be recovered. Examples are:</p>
<ul class="simple">
<li><p>Blurry imges <span class="math notranslate nohighlight">\(\rightarrow\)</span> promote smoothness <span class="math notranslate nohighlight">\(\Psi (\mathbf{x}) = \left\| \underbrace{\Delta}_{\text{Laplace operator}} \mathbf{x} \right\|_2 \)</span></p></li>
<li><p>Sparse images (e.g., stars) <span class="math notranslate nohighlight">\(\rightarrow\)</span> promote sparsity <span class="math notranslate nohighlight">\(\Psi (\mathbf{x}) = \left\| \mathbf{x} \right\|_1\)</span></p></li>
<li><p>Natural images <span class="math notranslate nohighlight">\(\rightarrow\)</span> promote spares gradients <span class="math notranslate nohighlight">\(\Psi \mathrm{TV}(\mathbf{x})\)</span></p></li>
</ul>
<section id="total-variation">
<h5>Total Variation<a class="headerlink" href="#total-variation" title="Permalink to this headline">#</a></h5>
<p>The intuition behind total variation is that in natural images, regions of almost constant intensities are separated by sharp edges. Hence, the gradient of such images can be assumed to be sparse.</p>
<p>The gradient is calculated by means of convolutions with the finite difference operators in <span class="math notranslate nohighlight">\(x\)</span>- and <span class="math notranslate nohighlight">\(y\)</span>-direction:</p>
<ul class="simple">
<li><p>Finite difference in <span class="math notranslate nohighlight">\(x\)</span>-direction: <span class="math notranslate nohighlight">\(d_x * x = \begin{pmatrix} 0 &amp; 0 &amp; 0 \\ 0 &amp; -1 &amp; 1 \\ 0 &amp; 0 &amp; 0  \end{pmatrix} * x = \mathbf{D}_x \mathbf{x}\)</span></p></li>
<li><p>Finite difference in <span class="math notranslate nohighlight">\(y\)</span>-direction: <span class="math notranslate nohighlight">\(d_y * x = \begin{pmatrix} 0 &amp; 0 &amp; 0 \\ 0 &amp; -1 &amp; 0 \\ 0 &amp; 1 &amp; 0  \end{pmatrix} * x = \mathbf{D}_y \mathbf{x}\)</span></p></li>
</ul>
<ul class="simple">
<li><p>Anisotropic:
<span class="math notranslate nohighlight">\(\begin{align} 
\mathrm{TV}(\mathbf{x}) &amp;= \left\| \mathbf{D}_x \mathbf{x} \right\|_1 + \left\| \mathbf{D}_y \mathbf{x} \right\|_1 \\ 
&amp;=  \sum\limits^N_{i=1}  \left| (\mathbf{D}_x \mathbf{x})_i \right| + \left| (\mathbf{D}_y \mathbf{x})_i \right| = \sum\limits^N_{i=1} \sqrt[]{(\mathbf{D}_x \mathbf{x})^2_i} + \sum\limits^N_{i=1} \sqrt[]{(\mathbf{D}_y \mathbf{x})^2_i} 
\end{align}\)</span></p></li>
<li><p>Isotropic:
<span class="math notranslate nohighlight">\(\begin{align} 
\mathrm{TV}(\mathbf{x}) = \left\| \begin{pmatrix} (\mathbf{D}_x \mathbf{x})_i \\ (\mathbf{D}_y \mathbf{x})_i \end{pmatrix} \right\|_2 = \sum\limits^N_{i=1}  \sqrt[]{(\mathbf{D}_x \mathbf{x})^2_i + (\mathbf{D}_y \mathbf{x})^2_i}
\end{align}\)</span></p></li>
</ul>
<p><strong>TODO: Add images!</strong></p>
</section>
</section>
<section id="half-quadratic-splitting-hqs-method">
<h4>Half-quadratic splitting (HQS) method<a class="headerlink" href="#half-quadratic-splitting-hqs-method" title="Permalink to this headline">#</a></h4>
<p>This section introduces a flexible, powerful and intuitive iterative approach, the half-quadratic splitting (HQS) method, for solving regularized inverse problems formulated like \eqref{eq:map_solution}.</p>
<p>We start with some general considerations and then apply HQS to the inverse problem of deconvolution.</p>
<p>We assuem the following imge formation model:</p>
<p><span class="math notranslate nohighlight">\(\begin{align} 
  \mathbf{b} = \mathbf{Ax} + \mathbf{\eta},
\end{align}\)</span></p>
<p>with <span class="math notranslate nohighlight">\(\mathbf{x}\in \mathbb{R}^{N}\)</span> denoting the unknown vector, <span class="math notranslate nohighlight">\(\mathbf{b}\in \mathbb{R}^{M}\)</span> representing the observations, the additive noise <span class="math notranslate nohighlight">\(\mathbf{\eta}\in \mathbb{R}^{M}\)</span> and the matrix <span class="math notranslate nohighlight">\(\mathbf{A}\in \mathbb{R}^{M\times N}\)</span> encoding the linear image formation model.</p>
<p>Equation \eqref{eq:map_solution} leads us to the general formulation of regularized inverse problems in the field of computational imaging:</p>
<p>\begin{align}\label{eq:general_inverse_problem}
\hat{\mathbf{x}} = \argmin{\mathbf{x}} , \underbrace{\frac{1}{2} \left| \mathbf{Ax-b} \right|^2_2}<em>{\text{data fidelity term}} + \underbrace{\lambda \Psi (\mathbf{x}) }</em>{\text{regularizer}},.
\end{align}</p>
<p>The data fidelity term ensures that the sought solution <span class="math notranslate nohighlight">\(\mathbf{\hat{x}}\)</span> matches the observed data <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> when fed through the image formation process (modelled by <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>). The regularization operator <span class="math notranslate nohighlight">\(\Psi : \mathbb{R}^{N} \rightarrow \mathbb{R}^M\)</span> models prior knowledge about the unknown original data <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>. The scalar parameter <span class="math notranslate nohighlight">\(\lambda \)</span> balances between the data fidelity term and the regularization term and hence <span class="math notranslate nohighlight">\(\lambda \in [ 0,1 ]\)</span>.</p>
<p>Trying to directly solve \eqref{eq:general_inverse_problem}, e.g., via gradient descent, often does not work well. Reasons are poor convergence or difficulties in finding an efficient way to calculate the gradient. Even worse, whenever we change the regularizer, we will have to re-write the optimization program again.</p>
<p>Hence, rewrite \eqref{eq:general_inverse_problem} to:</p>
<p>\begin{align} \label{eq:hqs_1}
\argmin{\mathbf{x}}\quad &amp;\underbrace{\frac{1}{2}\left| \mathbf{Ax-b} \right|^2_2 }<em>{=:f(\mathbf{x})} + \underbrace{\lambda \Psi (\mathbf{z})}</em>{=:g(\mathbf{z})} \
\text{subject to}\quad &amp;\mathbf{Dx-z} = \mathbf{0} ,.
\end{align}</p>
<p>We introduced a so-called <em>slack variable</em> <span class="math notranslate nohighlight">\(\mathbf{z}\in \mathbb{R}^O\)</span> which allows us to separate the data fidelity term and the regularization term so that they do not depend on the same variable anymore. Obviously, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{z}\)</span> are still linked by the constraint <span class="math notranslate nohighlight">\(\mathbf{Dx-z=0}\)</span>.</p>
<p>For now, we assume <span class="math notranslate nohighlight">\(\mathbf{D}\in \mathbb{R}^{N\times O}\)</span> to represent the identity matrix (i.e., it does not introduce any changes and can be ignored for now) - it will come back into play later on.</p>
<p>We now include the constraint of \eqref{eq:hqs_1} directly in the main optimization objective term via a penalty term:</p>
<p>\begin{align}\label{eq:hqs_2}
L_\rho (\mathbf{x}, \mathbf{z}) = f(\mathbf{x}) + g(\mathbf{z}) + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2,, \qquad \text{with }\rho &gt; 0,.
\end{align}</p>
<p>Intuitively, setting <span class="math notranslate nohighlight">\(\rho\)</span> to a large value leads to the same results for minimizing \eqref{eq:hqs_1} and \eqref{eq:hqs_2}. The benefit of this reformulation is that we can perform gradient descent for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{z}\)</span> in an alternating fashion.</p>
<p>\begin{align}
&amp;\mathbf{x} \leftarrow \mathrm{prox}<em>{f,\rho} (\mathbf{z}) = \argmin{\mathbf{x}} L</em>\rho (\mathbf{x}, \mathbf{z}) = \argmin{\mathbf{x}} f(\mathbf{x}) + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2,, \
&amp;\mathbf{z} \leftarrow \mathrm{prox}<em>{g,\rho} (\mathbf{Dx}) = \argmin{\mathbf{z}} L</em>\rho (\mathbf{x}, \mathbf{z}) = \argmin{\mathbf{z}} g(\mathbf{z}) + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2,.
\end{align}</p>
<p>TODO: Explain proximal operators.</p>
<p>Again, the important benefit of this formulation is that we can update <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{z}\)</span> separately. We will see that this approach allows us to easily experiment with different regularizers (this is sometimes also referred to as a <em>plug-and-play</em> formulation).</p>
<section id="hqs-for-deconvolution">
<h5>HQS for deconvolution<a class="headerlink" href="#hqs-for-deconvolution" title="Permalink to this headline">#</a></h5>
<p>We now again consider the inverse problem of deconvolution with circual boundary conditions. Here, the matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is the square circulant Toeplitz matrix <span class="math notranslate nohighlight">\(\mathbf{C} \in \mathbb{R}^{N\times N}\)</span> representing a 2D-convolution of the input image <span class="math notranslate nohighlight">\(x\)</span> with the convolution kernel <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Revise the duality between the signal processing formulation and the algebraic formulation:</p>
<p>\begin{align}
c<em>x = \Fi \left{ \F \left{ c \right} \cdot \F \left{ x \right}  \right} &amp;\Leftrightarrow \mathbf{Cx} ,, \
\Fi \left{ \F \left{ c \right}^</em> \cdot \F \left{ x \right}   \right} &amp;\Leftrightarrow \mathbf{C}\transp \mathbf{x},, \
\Fi \left{ \frac{\F \left{ b \right} }{\F \left{ c \right} } \right} &amp;\Leftrightarrow \mathbf{C}^{-1} \mathbf{b},.
\end{align}</p>
<section id="hqs-with-total-variation-and-denoising-regularizers">
<h6>HQS with total variation and denoising regularizers<a class="headerlink" href="#hqs-with-total-variation-and-denoising-regularizers" title="Permalink to this headline">#</a></h6>
<p>The initial formulation \eqref{eq:hqs_1} of HQS depends on which regularizer we employ.</p>
<p>For total variation this is:
\begin{align}
\argmin{\mathbf{x}}\quad &amp;\underbrace{\frac{1}{2}\left| \mathbf{Dx-b} \right|^2_2 }_{=:f(\mathbf{x})} + \underbrace{\lambda \left| \mathbf{z} \right|<em>1 }</em>{=:g(\mathbf{z})} \
\text{subject to}\quad &amp;\mathbf{Dx-z} = \mathbf{0} ,,
\end{align}</p>
<p>with <span class="math notranslate nohighlight">\(\mathbf{D} = \left( \mathbf{D}\transp_x \mathbf{D}\transp_y \right)\transp \in \mathbb{R}^{2N \times N}\)</span> representing the finite difference operator for calculating the gradients of <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> in <span class="math notranslate nohighlight">\(x\)</span>- and <span class="math notranslate nohighlight">\(y\)</span>-direction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The vector <span class="math notranslate nohighlight">\(\mathbf{z}\in \mathbb{R}^{2N}\)</span> has to be twice as large as <span class="math notranslate nohighlight">\(\mathbf{x}\in \mathbb{R}^{N} \)</span> in order to store the two gradient values in <span class="math notranslate nohighlight">\(x\)</span>- and <span class="math notranslate nohighlight">\(y\)</span>-direction for every input pixel.</p>
</div>
<p>In the more general case, we use a regularizer <span class="math notranslate nohighlight">\(\Psi \)</span> projecting an image onto the set of feasible natural images (more on that later):</p>
<p>\begin{align}
\argmin{\mathbf{x}}\quad &amp;\underbrace{\frac{1}{2}\left| \mathbf{Dx-b} \right|^2_2 }<em>{=:f(\mathbf{x})} + \underbrace{\lambda  \Psi (\mathbf{z})}</em>{=:g(\mathbf{z})} \
\text{subject to}\quad &amp;\mathbf{x-z} = \mathbf{0} ,.
\end{align}</p>
<p>Here the matrix <span class="math notranslate nohighlight">\(D\)</span> represents the identity matrix which is why it can be omitted.</p>
</section>
<section id="efficient-implementation-of-x-update">
<h6>Efficient implementation of <span class="math notranslate nohighlight">\(x\)</span>-update<a class="headerlink" href="#efficient-implementation-of-x-update" title="Permalink to this headline">#</a></h6>
<p>For obtaining the <span class="math notranslate nohighlight">\(x\)</span>-update, we have to derive the proximal operator <span class="math notranslate nohighlight">\(\mathrm{prox}_{f,\rho}\)</span>:
\begin{align}
\mathrm{prox}_{f,\rho} (\mathbf{z}) = \argmin{\mathbf{x}} f(\mathbf{x}) + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2 = \argmin{\mathbf{x}} \frac{1}{2} \left| \mathbf{Cx-b} \right|^2_2 + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2 ,.
\end{align}
Hence, we have to derive the gradient of that equation with respect to <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>.</p>
<p>We iteratively expand that equation as follows:
\begin{align}
&amp;\frac{1}{2} \left| \mathbf{Cx-b} \right|^2_2 + \frac{\rho}{2} \left| \mathbf{Dx-z} \right|^2_2 \
=&amp;\frac{1}{2} (\mathbf{Cx-b})\transp (\mathbf{Cx-b}) + \frac{\rho}{2} (\mathbf{Dx-z})\transp (\mathbf{Dx-z}) \
=&amp;\frac{1}{2} (\mathbf{x}\transp \mathbf{C}\transp \mathbf{Cx} - 2\mathbf{x}\transp \mathbf{C}\transp \mathbf{b} + \mathbf{b}\transp \mathbf{b}) + \frac{\rho}{2} (\mathbf{x}\transp \mathbf{D}\transp \mathbf{D} \mathbf{x} - 2 \mathbf{x}\transp \mathbf{D}\transp \mathbf{z} + \mathbf{z}\transp\mathbf{z}) ,.
\end{align}</p>
<p>The sought gradient is
\begin{align}
\mathbf{C}\transp \mathbf{Cx} - \mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{Dx} - \rho \mathbf{D}\transp \mathbf{z} ,.
\end{align}</p>
<p>This expression can now be equated to zero and solved for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>.</p>
<p>The single steps are:
\begin{align}
\mathbf{C}\transp \mathbf{Cx} - \mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{Dx} - \rho \mathbf{D}\transp \mathbf{z}\quad &amp;\overset{!}{=} \quad \mathbf{0} \
\mathbf{C}\transp \mathbf{Cx} + \rho \mathbf{D}\transp \mathbf{Dx}
&amp;\overset{!}{=} \quad \mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{z} \
(\mathbf{C}\transp \mathbf{C} + \rho \mathbf{D}\transp \mathbf{D})\mathbf{x}
&amp;\overset{!}{=} \quad \mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{z} \
\mathbf{x} &amp;\overset{!}{=} (\mathbf{C}\transp \mathbf{C} + \rho \mathbf{D}\transp \mathbf{D})^{-1}(\mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{z}) ,.
\end{align}</p>
<p>This yields a first formulation for the sought proximal operator:
\begin{align}\label{eq:hqs_tv_1}
\mathrm{prox}_{f,\rho} (\mathbf{z}) = (\mathbf{C}\transp \mathbf{C} + \rho \mathbf{D}\transp \mathbf{D})^{-1}(\mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{z}) ,.
\end{align}</p>
</section>
<section id="special-case-of-total-variation-regularizer">
<h6>Special case of total variation regularizer<a class="headerlink" href="#special-case-of-total-variation-regularizer" title="Permalink to this headline">#</a></h6>
<p>For the TV regularizer, the matrix <span class="math notranslate nohighlight">\(\mathbf{D}\)</span> represents the finite difference operator.  The matrix-vector multiplications involved in the proximal operator, i.e., <span class="math notranslate nohighlight">\(\mathbf{Cx}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{Dx} = \left[ \mathbf{D}\transp_x \mathbf{D}\transp_y  \right]\transp \mathbf{x}\)</span> (and also their adjoint correspondencies <span class="math notranslate nohighlight">\(\mathbf{C}\transp \mathbf{b}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{D}\transp \mathbf{z} = \left[ \mathbf{D}\transp_x \mathbf{D}\transp_y  \right] \mathbf{z} =  \mathbf{D}\transp_x \mathbf{z} + \mathbf{D}\transp_y \mathbf{z}   \)</span> ) all encode 2D-convolutions with circular boundary conditions.</p>
<p>Exploiting the duality of the signal-processing perspective and the algebraic perspective yields the following reforumlations of the denominator, respectively, of the nominator of \eqref{eq:hqs_tv_1}:
\begin{align}
(\mathbf{C}\transp \mathbf{C} + \rho \mathbf{D}\transp \mathbf{D}) &amp;\Leftrightarrow \Fi \left{ \F \left{ c \right}^* \cdot \F \left{ c \right} + \rho \left( \F \left{ d_x \right}^* \cdot \F \left{ d_x \right} + \F \left{ d_y \right}^* \cdot \F \left{  d_y \right}     \right)   \right} , , \
(\mathbf{C}\transp \mathbf{b} + \rho \mathbf{D}\transp \mathbf{z}) &amp;\Leftrightarrow \Fi \left{ \F \left{ c \right}^* \cdot \F \left{ b \right} + \rho \left( \F \left{ d_x \right}^* \cdot \F \left{ z \right} + \F \left{ d_y \right}^* \cdot \F \left{  z \right}  	  \right)   \right} ,,
\end{align}
with <span class="math notranslate nohighlight">\((\cdot)^*\)</span> denoting the element-wise complex conjugate.</p>
<p>Combining both terms in the original fraction yields the sought proximal operator:</p>
<p>\begin{align}
\mathrm{prox}_{\left| \cdot \right|_2 ,\rho} (\mathbf{z}) = \Fi \left{  \frac{\F \left{ c \right}^* \cdot \F \left{ b \right} + \rho \left( \F \left{ d_x \right}^* \cdot \F \left{ z \right} + \F \left{ d_y \right}^* \cdot \F \left{  z \right}  	  \right)}{\F \left{ c \right}^* \cdot \F \left{ c \right} + \rho \left( \F \left{ d_x \right}^* \cdot \F \left{ d_x \right} + \F \left{ d_y \right}^* \cdot \F \left{  d_y \right}     \right)} \right} ,.
\end{align}</p>
<p>As for the inverse filer introduced before, this proximal operator is also unstable with respect to noise and zeros in the involved Fourier transforms. However, the integration into the HQS iterations will mitigate these effects so that the resulting estimate <span class="math notranslate nohighlight">\(\mathbf{\hat{x}}\)</span> will not be affected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All terms of the proximal operator that do not depend on <span class="math notranslate nohighlight">\(z\)</span> only have to be computed once and can then be reused.</p>
</div>
</section>
<section id="general-regularizer">
<h6>General regularizer<a class="headerlink" href="#general-regularizer" title="Permalink to this headline">#</a></h6>
<p>For a general regularizer, we assume <span class="math notranslate nohighlight">\(\mathbf{D}\)</span> to be the identity matrix so that it can be ignored. The proximal operator can then be written as:</p>
<p>\begin{align}
\mathrm{prox}_{\left| \cdot \right|_2 ,\rho} (\mathbf{z}) = \Fi \left{ \frac{\F \left{ c \right}^* \cdot \F \left{ b \right} + \rho \F \left{ z \right}  }{\F \left{ c \right}^* \cdot \F \left{ c \right} + \rho}  \right} ,.
\end{align}</p>
</section>
</section>
<section id="efficient-implementation-of-z-update-for-anisotropic-tv-regularizer">
<h5>Efficient implementation of <span class="math notranslate nohighlight">\(z\)</span>-update for anisotropic TV regularizer<a class="headerlink" href="#efficient-implementation-of-z-update-for-anisotropic-tv-regularizer" title="Permalink to this headline">#</a></h5>
<p>For the <span class="math notranslate nohighlight">\(z\)</span>-update, we need to find a solution for the proximal operator
\begin{align}
\mathrm{prox}_{\left| \cdot \right|_1, \rho } (\mathbf{Dx}) = \argmin{\mathbf{z}} \lambda \left| \mathbf{z} \right|_1 + \frac{\rho}{2}\left| \mathbf{Dx-z} \right|^2_2 ,.<br />
\end{align}</p>
<p>To simplify the writing, we substitute <span class="math notranslate nohighlight">\(\mathbf{v} = \mathbf{Dx}\)</span>:</p>
<p>\begin{align}
\mathrm{prox}_{\left| \cdot \right|_1, \rho } (\mathbf{v}) = \argmin{\mathbf{z}} \lambda \left| \mathbf{z} \right|_1 + \frac{\rho}{2}\left| \mathbf{v-z} \right|^2_2 ,.<br />
\end{align}</p>
<p>We now have to calculate the gradient of that expression with respect to <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>. To easily follow the derivation, we will work on a single element of the gradient, i.e., we consider the scalar function</p>
<p>\begin{align}
h(z) = \frac{\rho}{2}(v-z)^2 + \lambda \vert z \vert ,.
\end{align}</p>
<p>In order to calculate the gradient <span class="math notranslate nohighlight">\(h'(z)\)</span> of <span class="math notranslate nohighlight">\(h(z)\)</span>, we can work on the two terms of the addition separately. The derivative of the first term <span class="math notranslate nohighlight">\(\frac{\rho}{2}(v-z)^2\)</span> is
\begin{align}
\frac{\mathrm{d}}{\mathrm{d}z},, \frac{\rho}{2}(v-z)^2 = \rho (-v + z) ,.
\end{align}
Unfortunately, the absolute value function <span class="math notranslate nohighlight">\(\vert \cdot \vert\)</span> (i.e., the 1-norm <span class="math notranslate nohighlight">\(\left\| \cdot \right\|_1\)</span>) is not differentiable and we have to take a detour to solve that problem.</p>
<p>For convex functions there is the concept of subdifferentials and subgradients which can be employed to approximate the gradient of convex functions at positions where they are not differentiable.</p>
<p>Consider a convex function <span class="math notranslate nohighlight">\(f:\mathcal{S} \rightarrow \mathbb{R}\)</span> defined on the open interval <span class="math notranslate nohighlight">\(\mathcal{S}\)</span>. According to Taylor’s theorem, the linear approximation of such a function <span class="math notranslate nohighlight">\(f\)</span> at any point is strictly smaller than the value of the function at that point itself, i.e.,
\begin{align}
\forall a \in \mathcal{S}: f(x) \geq f(a) + f’(a)(x-a) ,.
\end{align}
This inequality also holds for other values <span class="math notranslate nohighlight">\(g\)</span> instead of <span class="math notranslate nohighlight">\(f'(a)\)</span>, which are smaller than the true gradient <span class="math notranslate nohighlight">\(f'(a)\)</span> and since a gradient is never infinite, there have to be infinitely many of suitable <span class="math notranslate nohighlight">\(g\)</span>:
\begin{align}
\forall a \in \mathcal{S} \exists g \in \mathbb{R}: f(x) \geq f(a) + g(x-a) ,.
\end{align}
Such values <span class="math notranslate nohighlight">\(g\)</span> are called <em>subgradients</em> of the function <span class="math notranslate nohighlight">\(f\)</span> at position <span class="math notranslate nohighlight">\(a\)</span>. The set of all subgradients of <span class="math notranslate nohighlight">\(f\)</span> at position <span class="math notranslate nohighlight">\(a\)</span> is called the <em>subdifferential</em> <span class="math notranslate nohighlight">\(\partial_a f\)</span> of <span class="math notranslate nohighlight">\(f\)</span> at position <span class="math notranslate nohighlight">\(a\)</span>:
\begin{align}
\partial_a f(x) = \left{ g\in \mathbb{R}: f(x) \geq f(a) + g(x-a) \right}  ,.
\end{align}</p>
<p>Subdifferentials have the following useful properties (w.r.t a convex function <span class="math notranslate nohighlight">\(f\)</span> as defined above):</p>
<ul class="simple">
<li><p>The function <span class="math notranslate nohighlight">\(f\)</span> is differentiable at position <span class="math notranslate nohighlight">\(a\)</span> if and only if the set of subdifferentials at position <span class="math notranslate nohighlight">\(a\)</span> contains only a single slope value, i.e., if <span class="math notranslate nohighlight">\(\vert \partial_a f(x) \vert = 1\)</span>.</p></li>
<li><p>A point <span class="math notranslate nohighlight">\(a\)</span> is a global minimum of <span class="math notranslate nohighlight">\(f\)</span> if and only if <span class="math notranslate nohighlight">\(0 \in \partial_a f(x)\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(k(x)\)</span> be another convex function like <span class="math notranslate nohighlight">\(f\)</span>. With the subdifferentials <span class="math notranslate nohighlight">\(\partial_a f(x), \partial_a k(x)\)</span> for some position <span class="math notranslate nohighlight">\(a\)</span>, the subdifferential of <span class="math notranslate nohighlight">\(f+k\)</span> for position <span class="math notranslate nohighlight">\(a\)</span> is then <span class="math notranslate nohighlight">\(\partial_a (f+k)(x) = \partial_a f(x) \oplus \partial_a k(x)\)</span> with <span class="math notranslate nohighlight">\(\oplus\)</span> denoting the so-called Minkowski sum (i.e., the set of all possible sums between all elements of the two input sets).</p></li>
</ul>
<p>We will now derive the subdifferential of <span class="math notranslate nohighlight">\(h(z) = \frac{\rho}{2}(v-z)^2 + \lambda \vert z \vert \)</span> (neglecting the position <span class="math notranslate nohighlight">\(a\)</span> for simplicity) and look for subgradients of <span class="math notranslate nohighlight">\(0\)</span>, which correspond to the sought minimum.</p>
<p>According to the third property introduced before, it is:
\begin{align}
\partial h(z) = \partial \frac{\rho}{2}(v-z)^2 \oplus  \partial \lambda \vert z \vert ,.
\end{align}</p>
<p>Of course, the true gradient <span class="math notranslate nohighlight">\(f'(a)\)</span> of a function <span class="math notranslate nohighlight">\(f(x)\)</span> at position <span class="math notranslate nohighlight">\(a\)</span> is also a valid subgradient at position <span class="math notranslate nohighlight">\(a\)</span>, i.e.:
\begin{align}\label{eq:hqs_z_1}
\partial h(z) = \lbrace \rho(-v+z) \rbrace \oplus  \partial \lambda \vert z \vert ,.<br />
\end{align}</p>
<p>The subdifferentials for the absolute value function are:
\begin{align}\label{eq:hqs_z_2}
\partial \lambda \vert z \vert = \begin{cases}
&amp;-\lambda &amp;\text{ if } z &lt; 0\
&amp;[-\lambda, \lambda] &amp;\text{ if } z = 0\
&amp;\lambda &amp;\text{ if } z &gt; 0\
\end{cases} ,.
\end{align}
For <span class="math notranslate nohighlight">\(z\neq 0\)</span>, the absolute function is differentiable which is why its subdifferentials for those positions contains only one element (<span class="math notranslate nohighlight">\(\lambda\)</span> or <span class="math notranslate nohighlight">\(-\lambda\)</span> respectively). For <span class="math notranslate nohighlight">\(z=0\)</span> there infinitely many possible slope values inside the interval <span class="math notranslate nohighlight">\([-\lambda, \lambda]\)</span> (note: the value <span class="math notranslate nohighlight">\(0\)</span> is also contained in that interval, indicating that the global minimum must be at position <span class="math notranslate nohighlight">\(0\)</span>).</p>
<p>Combining \eqref{eq:hqs_z_1} and \eqref{eq:hqs_z_2} yields:
\begin{align}\label{eq:hqs_z_1}
\partial h(z) =  \begin{cases}
&amp;\rho(-v+z) - \lambda &amp;\text{ if } z &lt; 0\
&amp;[-\rho v-\lambda, -\rho v + \lambda] &amp;\text{ if } z = 0\
\end{cases} ,.
\end{align}</p>
<p>We now equate all cases separately to <span class="math notranslate nohighlight">\(0\)</span>, solve for <span class="math notranslate nohighlight">\(z\)</span> and calculate the corresponding interval for <span class="math notranslate nohighlight">\(v\)</span> (which is the variable that we know, so we can use it to decide which case applies):
\begin{align}
\textbf{Case 1,  } z &lt; 0: \quad &amp;\rho(-v+z) - \lambda \overset{!}{=}0 \Leftrightarrow z \overset{!}{=} v + \frac{\lambda}{\rho} \
&amp;v + \frac{\lambda}{\rho}  \overset{!}{&lt;} 0 \Leftrightarrow v &lt; - \frac{\lambda}{\rho} ,.
\end{align}</p>
<p>For the second case, which is where the sought minimum is located, we want to always return <span class="math notranslate nohighlight">\(0\)</span> which is why we have to make sure that <span class="math notranslate nohighlight">\(0\)</span> is contained in the interval of possible slopes, i.e.,  <span class="math notranslate nohighlight">\(0 \in [-\rho v-\lambda, -\rho v + \lambda]\)</span>. Hence, it must hold
\begin{align}
-\rho v - \lambda \leq 0 &amp;\Leftrightarrow v \geq - \frac{\lambda }{\rho } \quad \text{and} \
0 \leq -\rho v + \lambda  &amp;\Leftrightarrow v \leq \frac{\lambda}{\rho} ,,
\end{align}
i.e.,
\begin{align}
\textbf{Case 2,  } z &lt; 0: \quad \left| v \right| \leq \frac{\lambda }{\rho },.
\end{align}</p>
<p>The third case can be solved analogously to the first case:
\begin{align}
\textbf{Case 3,  } z &gt; 0: \quad &amp;\rho(-v-z) + \lambda \overset{!}{=}0 \Leftrightarrow z \overset{!}{=} v - \frac{\lambda}{\rho} \
&amp; v - \frac{\lambda}{\rho}  \overset{!}{&gt;} 0 \Leftrightarrow v &gt; \frac{\lambda}{\rho} ,.
\end{align}
<span class="math notranslate nohighlight">\(\square\)</span></p>
<p>The sought proximal operator is given by
\begin{align}
\mathrm{prox}_{\left| \cdot \right|_1, \rho } (\mathbf{v})<em>i =  \mathcal{S}</em>{\lambda / \rho} (v_i) = \begin{cases}
v_i + \frac{\lambda}{\rho} &amp;\text{if } v_i &lt; - \frac{\lambda}{\rho}\
0 &amp;\text{if } \left| v_i \right| \leq \frac{\lambda }{\rho }\
v_i - \frac{\lambda}{\rho} &amp;\text{if } v_i &gt; \frac{\lambda}{\rho}
\end{cases} ,,<br />
\end{align}
with <span class="math notranslate nohighlight">\(v_i\)</span> refering to the <span class="math notranslate nohighlight">\(i\)</span>-th element of the corresponding vector <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> (etc.).</p>
<p>The operator <span class="math notranslate nohighlight">\(\mathcal{S}\)</span> is also called the element-wise <em>soft thresholding operator</em>.</p>
</section>
<section id="visualization-of-soft-thresholding-operator">
<h5>Visualization of soft thresholding operator<a class="headerlink" href="#visualization-of-soft-thresholding-operator" title="Permalink to this headline">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lam</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">rho</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">kap</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">kap</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">-</span><span class="n">kap</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">+</span><span class="n">kap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">soft_thres_visu</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">lam</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">]</span>

    <span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">lam</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>

    <span class="c1">#plt.subplots(1,2)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cur_s</span><span class="o">:=</span><span class="n">s</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">lam</span><span class="o">/</span><span class="n">rho</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">cur_s</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">),</span> <span class="s1">&#39;bo&#39;</span> <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">ss</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">lam</span><span class="o">/</span><span class="n">rho</span><span class="p">),</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">interact</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">soft_thres_visu</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">v</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">3.0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">/* Put everything inside the global mpl namespace */
/* global mpl */
window.mpl = {};

mpl.get_websocket_type = function () {
    if (typeof WebSocket !== 'undefined') {
        return WebSocket;
    } else if (typeof MozWebSocket !== 'undefined') {
        return MozWebSocket;
    } else {
        alert(
            'Your browser does not have WebSocket support. ' +
                'Please try Chrome, Safari or Firefox ≥ 6. ' +
                'Firefox 4 and 5 are also supported but you ' +
                'have to enable WebSockets in about:config.'
        );
    }
};

mpl.figure = function (figure_id, websocket, ondownload, parent_element) {
    this.id = figure_id;

    this.ws = websocket;

    this.supports_binary = this.ws.binaryType !== undefined;

    if (!this.supports_binary) {
        var warnings = document.getElementById('mpl-warnings');
        if (warnings) {
            warnings.style.display = 'block';
            warnings.textContent =
                'This browser does not support binary websocket messages. ' +
                'Performance may be slow.';
        }
    }

    this.imageObj = new Image();

    this.context = undefined;
    this.message = undefined;
    this.canvas = undefined;
    this.rubberband_canvas = undefined;
    this.rubberband_context = undefined;
    this.format_dropdown = undefined;

    this.image_mode = 'full';

    this.root = document.createElement('div');
    this.root.setAttribute('style', 'display: inline-block');
    this._root_extra_style(this.root);

    parent_element.appendChild(this.root);

    this._init_header(this);
    this._init_canvas(this);
    this._init_toolbar(this);

    var fig = this;

    this.waiting = false;

    this.ws.onopen = function () {
        fig.send_message('supports_binary', { value: fig.supports_binary });
        fig.send_message('send_image_mode', {});
        if (fig.ratio !== 1) {
            fig.send_message('set_dpi_ratio', { dpi_ratio: fig.ratio });
        }
        fig.send_message('refresh', {});
    };

    this.imageObj.onload = function () {
        if (fig.image_mode === 'full') {
            // Full images could contain transparency (where diff images
            // almost always do), so we need to clear the canvas so that
            // there is no ghosting.
            fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);
        }
        fig.context.drawImage(fig.imageObj, 0, 0);
    };

    this.imageObj.onunload = function () {
        fig.ws.close();
    };

    this.ws.onmessage = this._make_on_message_function(this);

    this.ondownload = ondownload;
};

mpl.figure.prototype._init_header = function () {
    var titlebar = document.createElement('div');
    titlebar.classList =
        'ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix';
    var titletext = document.createElement('div');
    titletext.classList = 'ui-dialog-title';
    titletext.setAttribute(
        'style',
        'width: 100%; text-align: center; padding: 3px;'
    );
    titlebar.appendChild(titletext);
    this.root.appendChild(titlebar);
    this.header = titletext;
};

mpl.figure.prototype._canvas_extra_style = function (_canvas_div) {};

mpl.figure.prototype._root_extra_style = function (_canvas_div) {};

mpl.figure.prototype._init_canvas = function () {
    var fig = this;

    var canvas_div = (this.canvas_div = document.createElement('div'));
    canvas_div.setAttribute(
        'style',
        'border: 1px solid #ddd;' +
            'box-sizing: content-box;' +
            'clear: both;' +
            'min-height: 1px;' +
            'min-width: 1px;' +
            'outline: 0;' +
            'overflow: hidden;' +
            'position: relative;' +
            'resize: both;'
    );

    function on_keyboard_event_closure(name) {
        return function (event) {
            return fig.key_event(event, name);
        };
    }

    canvas_div.addEventListener(
        'keydown',
        on_keyboard_event_closure('key_press')
    );
    canvas_div.addEventListener(
        'keyup',
        on_keyboard_event_closure('key_release')
    );

    this._canvas_extra_style(canvas_div);
    this.root.appendChild(canvas_div);

    var canvas = (this.canvas = document.createElement('canvas'));
    canvas.classList.add('mpl-canvas');
    canvas.setAttribute('style', 'box-sizing: content-box;');

    this.context = canvas.getContext('2d');

    var backingStore =
        this.context.backingStorePixelRatio ||
        this.context.webkitBackingStorePixelRatio ||
        this.context.mozBackingStorePixelRatio ||
        this.context.msBackingStorePixelRatio ||
        this.context.oBackingStorePixelRatio ||
        this.context.backingStorePixelRatio ||
        1;

    this.ratio = (window.devicePixelRatio || 1) / backingStore;

    var rubberband_canvas = (this.rubberband_canvas = document.createElement(
        'canvas'
    ));
    rubberband_canvas.setAttribute(
        'style',
        'box-sizing: content-box; position: absolute; left: 0; top: 0; z-index: 1;'
    );

    // Apply a ponyfill if ResizeObserver is not implemented by browser.
    if (this.ResizeObserver === undefined) {
        if (window.ResizeObserver !== undefined) {
            this.ResizeObserver = window.ResizeObserver;
        } else {
            var obs = _JSXTOOLS_RESIZE_OBSERVER({});
            this.ResizeObserver = obs.ResizeObserver;
        }
    }

    this.resizeObserverInstance = new this.ResizeObserver(function (entries) {
        var nentries = entries.length;
        for (var i = 0; i < nentries; i++) {
            var entry = entries[i];
            var width, height;
            if (entry.contentBoxSize) {
                if (entry.contentBoxSize instanceof Array) {
                    // Chrome 84 implements new version of spec.
                    width = entry.contentBoxSize[0].inlineSize;
                    height = entry.contentBoxSize[0].blockSize;
                } else {
                    // Firefox implements old version of spec.
                    width = entry.contentBoxSize.inlineSize;
                    height = entry.contentBoxSize.blockSize;
                }
            } else {
                // Chrome <84 implements even older version of spec.
                width = entry.contentRect.width;
                height = entry.contentRect.height;
            }

            // Keep the size of the canvas and rubber band canvas in sync with
            // the canvas container.
            if (entry.devicePixelContentBoxSize) {
                // Chrome 84 implements new version of spec.
                canvas.setAttribute(
                    'width',
                    entry.devicePixelContentBoxSize[0].inlineSize
                );
                canvas.setAttribute(
                    'height',
                    entry.devicePixelContentBoxSize[0].blockSize
                );
            } else {
                canvas.setAttribute('width', width * fig.ratio);
                canvas.setAttribute('height', height * fig.ratio);
            }
            canvas.setAttribute(
                'style',
                'width: ' + width + 'px; height: ' + height + 'px;'
            );

            rubberband_canvas.setAttribute('width', width);
            rubberband_canvas.setAttribute('height', height);

            // And update the size in Python. We ignore the initial 0/0 size
            // that occurs as the element is placed into the DOM, which should
            // otherwise not happen due to the minimum size styling.
            if (fig.ws.readyState == 1 && width != 0 && height != 0) {
                fig.request_resize(width, height);
            }
        }
    });
    this.resizeObserverInstance.observe(canvas_div);

    function on_mouse_event_closure(name) {
        return function (event) {
            return fig.mouse_event(event, name);
        };
    }

    rubberband_canvas.addEventListener(
        'mousedown',
        on_mouse_event_closure('button_press')
    );
    rubberband_canvas.addEventListener(
        'mouseup',
        on_mouse_event_closure('button_release')
    );
    rubberband_canvas.addEventListener(
        'dblclick',
        on_mouse_event_closure('dblclick')
    );
    // Throttle sequential mouse events to 1 every 20ms.
    rubberband_canvas.addEventListener(
        'mousemove',
        on_mouse_event_closure('motion_notify')
    );

    rubberband_canvas.addEventListener(
        'mouseenter',
        on_mouse_event_closure('figure_enter')
    );
    rubberband_canvas.addEventListener(
        'mouseleave',
        on_mouse_event_closure('figure_leave')
    );

    canvas_div.addEventListener('wheel', function (event) {
        if (event.deltaY < 0) {
            event.step = 1;
        } else {
            event.step = -1;
        }
        on_mouse_event_closure('scroll')(event);
    });

    canvas_div.appendChild(canvas);
    canvas_div.appendChild(rubberband_canvas);

    this.rubberband_context = rubberband_canvas.getContext('2d');
    this.rubberband_context.strokeStyle = '#000000';

    this._resize_canvas = function (width, height, forward) {
        if (forward) {
            canvas_div.style.width = width + 'px';
            canvas_div.style.height = height + 'px';
        }
    };

    // Disable right mouse context menu.
    this.rubberband_canvas.addEventListener('contextmenu', function (_e) {
        event.preventDefault();
        return false;
    });

    function set_focus() {
        canvas.focus();
        canvas_div.focus();
    }

    window.setTimeout(set_focus, 100);
};

mpl.figure.prototype._init_toolbar = function () {
    var fig = this;

    var toolbar = document.createElement('div');
    toolbar.classList = 'mpl-toolbar';
    this.root.appendChild(toolbar);

    function on_click_closure(name) {
        return function (_event) {
            return fig.toolbar_button_onclick(name);
        };
    }

    function on_mouseover_closure(tooltip) {
        return function (event) {
            if (!event.currentTarget.disabled) {
                return fig.toolbar_button_onmouseover(tooltip);
            }
        };
    }

    fig.buttons = {};
    var buttonGroup = document.createElement('div');
    buttonGroup.classList = 'mpl-button-group';
    for (var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            /* Instead of a spacer, we start a new button group. */
            if (buttonGroup.hasChildNodes()) {
                toolbar.appendChild(buttonGroup);
            }
            buttonGroup = document.createElement('div');
            buttonGroup.classList = 'mpl-button-group';
            continue;
        }

        var button = (fig.buttons[name] = document.createElement('button'));
        button.classList = 'mpl-widget';
        button.setAttribute('role', 'button');
        button.setAttribute('aria-disabled', 'false');
        button.addEventListener('click', on_click_closure(method_name));
        button.addEventListener('mouseover', on_mouseover_closure(tooltip));

        var icon_img = document.createElement('img');
        icon_img.src = '_images/' + image + '.png';
        icon_img.srcset = '_images/' + image + '_large.png 2x';
        icon_img.alt = tooltip;
        button.appendChild(icon_img);

        buttonGroup.appendChild(button);
    }

    if (buttonGroup.hasChildNodes()) {
        toolbar.appendChild(buttonGroup);
    }

    var fmt_picker = document.createElement('select');
    fmt_picker.classList = 'mpl-widget';
    toolbar.appendChild(fmt_picker);
    this.format_dropdown = fmt_picker;

    for (var ind in mpl.extensions) {
        var fmt = mpl.extensions[ind];
        var option = document.createElement('option');
        option.selected = fmt === mpl.default_extension;
        option.innerHTML = fmt;
        fmt_picker.appendChild(option);
    }

    var status_bar = document.createElement('span');
    status_bar.classList = 'mpl-message';
    toolbar.appendChild(status_bar);
    this.message = status_bar;
};

mpl.figure.prototype.request_resize = function (x_pixels, y_pixels) {
    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,
    // which will in turn request a refresh of the image.
    this.send_message('resize', { width: x_pixels, height: y_pixels });
};

mpl.figure.prototype.send_message = function (type, properties) {
    properties['type'] = type;
    properties['figure_id'] = this.id;
    this.ws.send(JSON.stringify(properties));
};

mpl.figure.prototype.send_draw_message = function () {
    if (!this.waiting) {
        this.waiting = true;
        this.ws.send(JSON.stringify({ type: 'draw', figure_id: this.id }));
    }
};

mpl.figure.prototype.handle_save = function (fig, _msg) {
    var format_dropdown = fig.format_dropdown;
    var format = format_dropdown.options[format_dropdown.selectedIndex].value;
    fig.ondownload(fig, format);
};

mpl.figure.prototype.handle_resize = function (fig, msg) {
    var size = msg['size'];
    if (size[0] !== fig.canvas.width || size[1] !== fig.canvas.height) {
        fig._resize_canvas(size[0], size[1], msg['forward']);
        fig.send_message('refresh', {});
    }
};

mpl.figure.prototype.handle_rubberband = function (fig, msg) {
    var x0 = msg['x0'] / fig.ratio;
    var y0 = (fig.canvas.height - msg['y0']) / fig.ratio;
    var x1 = msg['x1'] / fig.ratio;
    var y1 = (fig.canvas.height - msg['y1']) / fig.ratio;
    x0 = Math.floor(x0) + 0.5;
    y0 = Math.floor(y0) + 0.5;
    x1 = Math.floor(x1) + 0.5;
    y1 = Math.floor(y1) + 0.5;
    var min_x = Math.min(x0, x1);
    var min_y = Math.min(y0, y1);
    var width = Math.abs(x1 - x0);
    var height = Math.abs(y1 - y0);

    fig.rubberband_context.clearRect(
        0,
        0,
        fig.canvas.width / fig.ratio,
        fig.canvas.height / fig.ratio
    );

    fig.rubberband_context.strokeRect(min_x, min_y, width, height);
};

mpl.figure.prototype.handle_figure_label = function (fig, msg) {
    // Updates the figure title.
    fig.header.textContent = msg['label'];
};

mpl.figure.prototype.handle_cursor = function (fig, msg) {
    var cursor = msg['cursor'];
    switch (cursor) {
        case 0:
            cursor = 'pointer';
            break;
        case 1:
            cursor = 'default';
            break;
        case 2:
            cursor = 'crosshair';
            break;
        case 3:
            cursor = 'move';
            break;
    }
    fig.rubberband_canvas.style.cursor = cursor;
};

mpl.figure.prototype.handle_message = function (fig, msg) {
    fig.message.textContent = msg['message'];
};

mpl.figure.prototype.handle_draw = function (fig, _msg) {
    // Request the server to send over a new figure.
    fig.send_draw_message();
};

mpl.figure.prototype.handle_image_mode = function (fig, msg) {
    fig.image_mode = msg['mode'];
};

mpl.figure.prototype.handle_history_buttons = function (fig, msg) {
    for (var key in msg) {
        if (!(key in fig.buttons)) {
            continue;
        }
        fig.buttons[key].disabled = !msg[key];
        fig.buttons[key].setAttribute('aria-disabled', !msg[key]);
    }
};

mpl.figure.prototype.handle_navigate_mode = function (fig, msg) {
    if (msg['mode'] === 'PAN') {
        fig.buttons['Pan'].classList.add('active');
        fig.buttons['Zoom'].classList.remove('active');
    } else if (msg['mode'] === 'ZOOM') {
        fig.buttons['Pan'].classList.remove('active');
        fig.buttons['Zoom'].classList.add('active');
    } else {
        fig.buttons['Pan'].classList.remove('active');
        fig.buttons['Zoom'].classList.remove('active');
    }
};

mpl.figure.prototype.updated_canvas_event = function () {
    // Called whenever the canvas gets updated.
    this.send_message('ack', {});
};

// A function to construct a web socket function for onmessage handling.
// Called in the figure constructor.
mpl.figure.prototype._make_on_message_function = function (fig) {
    return function socket_on_message(evt) {
        if (evt.data instanceof Blob) {
            var img = evt.data;
            if (img.type !== 'image/png') {
                /* FIXME: We get "Resource interpreted as Image but
                 * transferred with MIME type text/plain:" errors on
                 * Chrome.  But how to set the MIME type?  It doesn't seem
                 * to be part of the websocket stream */
                img.type = 'image/png';
            }

            /* Free the memory for the previous frames */
            if (fig.imageObj.src) {
                (window.URL || window.webkitURL).revokeObjectURL(
                    fig.imageObj.src
                );
            }

            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(
                img
            );
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        } else if (
            typeof evt.data === 'string' &&
            evt.data.slice(0, 21) === 'data:image/png;base64'
        ) {
            fig.imageObj.src = evt.data;
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }

        var msg = JSON.parse(evt.data);
        var msg_type = msg['type'];

        // Call the  "handle_{type}" callback, which takes
        // the figure and JSON message as its only arguments.
        try {
            var callback = fig['handle_' + msg_type];
        } catch (e) {
            console.log(
                "No handler for the '" + msg_type + "' message type: ",
                msg
            );
            return;
        }

        if (callback) {
            try {
                // console.log("Handling '" + msg_type + "' message: ", msg);
                callback(fig, msg);
            } catch (e) {
                console.log(
                    "Exception inside the 'handler_" + msg_type + "' callback:",
                    e,
                    e.stack,
                    msg
                );
            }
        }
    };
};

// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas
mpl.findpos = function (e) {
    //this section is from http://www.quirksmode.org/js/events_properties.html
    var targ;
    if (!e) {
        e = window.event;
    }
    if (e.target) {
        targ = e.target;
    } else if (e.srcElement) {
        targ = e.srcElement;
    }
    if (targ.nodeType === 3) {
        // defeat Safari bug
        targ = targ.parentNode;
    }

    // pageX,Y are the mouse positions relative to the document
    var boundingRect = targ.getBoundingClientRect();
    var x = e.pageX - (boundingRect.left + document.body.scrollLeft);
    var y = e.pageY - (boundingRect.top + document.body.scrollTop);

    return { x: x, y: y };
};

/*
 * return a copy of an object with only non-object keys
 * we need this to avoid circular references
 * http://stackoverflow.com/a/24161582/3208463
 */
function simpleKeys(original) {
    return Object.keys(original).reduce(function (obj, key) {
        if (typeof original[key] !== 'object') {
            obj[key] = original[key];
        }
        return obj;
    }, {});
}

mpl.figure.prototype.mouse_event = function (event, name) {
    var canvas_pos = mpl.findpos(event);

    if (name === 'button_press') {
        this.canvas.focus();
        this.canvas_div.focus();
    }

    var x = canvas_pos.x * this.ratio;
    var y = canvas_pos.y * this.ratio;

    this.send_message(name, {
        x: x,
        y: y,
        button: event.button,
        step: event.step,
        guiEvent: simpleKeys(event),
    });

    /* This prevents the web browser from automatically changing to
     * the text insertion cursor when the button is pressed.  We want
     * to control all of the cursor setting manually through the
     * 'cursor' event from matplotlib */
    event.preventDefault();
    return false;
};

mpl.figure.prototype._key_event_extra = function (_event, _name) {
    // Handle any extra behaviour associated with a key event
};

mpl.figure.prototype.key_event = function (event, name) {
    // Prevent repeat events
    if (name === 'key_press') {
        if (event.key === this._key) {
            return;
        } else {
            this._key = event.key;
        }
    }
    if (name === 'key_release') {
        this._key = null;
    }

    var value = '';
    if (event.ctrlKey && event.key !== 'Control') {
        value += 'ctrl+';
    }
    else if (event.altKey && event.key !== 'Alt') {
        value += 'alt+';
    }
    else if (event.shiftKey && event.key !== 'Shift') {
        value += 'shift+';
    }

    value += 'k' + event.key;

    this._key_event_extra(event, name);

    this.send_message(name, { key: value, guiEvent: simpleKeys(event) });
    return false;
};

mpl.figure.prototype.toolbar_button_onclick = function (name) {
    if (name === 'download') {
        this.handle_save(this, null);
    } else {
        this.send_message('toolbar_button', { name: name });
    }
};

mpl.figure.prototype.toolbar_button_onmouseover = function (tooltip) {
    this.message.textContent = tooltip;
};

///////////////// REMAINING CONTENT GENERATED BY embed_js.py /////////////////
// prettier-ignore
var _JSXTOOLS_RESIZE_OBSERVER=function(A){var t,i=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,o=new Set;function s(e){if(!(this instanceof s))throw new TypeError("Constructor requires 'new' operator");i.set(this,e)}function h(){throw new TypeError("Function is not a constructor")}function c(e,t,i,n){e=0 in arguments?Number(arguments[0]):0,t=1 in arguments?Number(arguments[1]):0,i=2 in arguments?Number(arguments[2]):0,n=3 in arguments?Number(arguments[3]):0,this.right=(this.x=this.left=e)+(this.width=i),this.bottom=(this.y=this.top=t)+(this.height=n),Object.freeze(this)}function d(){t=requestAnimationFrame(d);var s=new WeakMap,p=new Set;o.forEach((function(t){r.get(t).forEach((function(i){var r=t instanceof window.SVGElement,o=a.get(t),d=r?0:parseFloat(o.paddingTop),f=r?0:parseFloat(o.paddingRight),l=r?0:parseFloat(o.paddingBottom),u=r?0:parseFloat(o.paddingLeft),g=r?0:parseFloat(o.borderTopWidth),m=r?0:parseFloat(o.borderRightWidth),w=r?0:parseFloat(o.borderBottomWidth),b=u+f,F=d+l,v=(r?0:parseFloat(o.borderLeftWidth))+m,W=g+w,y=r?0:t.offsetHeight-W-t.clientHeight,E=r?0:t.offsetWidth-v-t.clientWidth,R=b+v,z=F+W,M=r?t.width:parseFloat(o.width)-R-E,O=r?t.height:parseFloat(o.height)-z-y;if(n.has(t)){var k=n.get(t);if(k[0]===M&&k[1]===O)return}n.set(t,[M,O]);var S=Object.create(h.prototype);S.target=t,S.contentRect=new c(u,d,M,O),s.has(i)||(s.set(i,[]),p.add(i)),s.get(i).push(S)}))})),p.forEach((function(e){i.get(e).call(e,s.get(e),e)}))}return s.prototype.observe=function(i){if(i instanceof window.Element){r.has(i)||(r.set(i,new Set),o.add(i),a.set(i,window.getComputedStyle(i)));var n=r.get(i);n.has(this)||n.add(this),cancelAnimationFrame(t),t=requestAnimationFrame(d)}},s.prototype.unobserve=function(i){if(i instanceof window.Element&&r.has(i)){var n=r.get(i);n.has(this)&&(n.delete(this),n.size||(r.delete(i),o.delete(i))),n.size||r.delete(i),o.size||cancelAnimationFrame(t)}},A.DOMRectReadOnly=c,A.ResizeObserver=s,A.ResizeObserverEntry=h,A}; // eslint-disable-line
mpl.toolbar_items = [["Home", "Reset original view", "fa fa-home icon-home", "home"], ["Back", "Back to previous view", "fa fa-arrow-left icon-arrow-left", "back"], ["Forward", "Forward to next view", "fa fa-arrow-right icon-arrow-right", "forward"], ["", "", "", ""], ["Pan", "Left button pans, Right button zooms\nx/y fixes axis, CTRL fixes aspect", "fa fa-arrows icon-move", "pan"], ["Zoom", "Zoom to rectangle\nx/y fixes axis, CTRL fixes aspect", "fa fa-square-o icon-check-empty", "zoom"], ["", "", "", ""], ["Download", "Download plot", "fa fa-floppy-o icon-save", "download"]];

mpl.extensions = ["eps", "jpeg", "pgf", "pdf", "png", "ps", "raw", "svg", "tif"];

mpl.default_extension = "png";/* global mpl */

var comm_websocket_adapter = function (comm) {
    // Create a "websocket"-like object which calls the given IPython comm
    // object with the appropriate methods. Currently this is a non binary
    // socket, so there is still some room for performance tuning.
    var ws = {};

    ws.binaryType = comm.kernel.ws.binaryType;
    ws.readyState = comm.kernel.ws.readyState;
    function updateReadyState(_event) {
        if (comm.kernel.ws) {
            ws.readyState = comm.kernel.ws.readyState;
        } else {
            ws.readyState = 3; // Closed state.
        }
    }
    comm.kernel.ws.addEventListener('open', updateReadyState);
    comm.kernel.ws.addEventListener('close', updateReadyState);
    comm.kernel.ws.addEventListener('error', updateReadyState);

    ws.close = function () {
        comm.close();
    };
    ws.send = function (m) {
        //console.log('sending', m);
        comm.send(m);
    };
    // Register the callback with on_msg.
    comm.on_msg(function (msg) {
        //console.log('receiving', msg['content']['data'], msg);
        var data = msg['content']['data'];
        if (data['blob'] !== undefined) {
            data = {
                data: new Blob(msg['buffers'], { type: data['blob'] }),
            };
        }
        // Pass the mpl event to the overridden (by mpl) onmessage function.
        ws.onmessage(data);
    });
    return ws;
};

mpl.mpl_figure_comm = function (comm, msg) {
    // This is the function which gets called when the mpl process
    // starts-up an IPython Comm through the "matplotlib" channel.

    var id = msg.content.data.id;
    // Get hold of the div created by the display call when the Comm
    // socket was opened in Python.
    var element = document.getElementById(id);
    var ws_proxy = comm_websocket_adapter(comm);

    function ondownload(figure, _format) {
        window.open(figure.canvas.toDataURL());
    }

    var fig = new mpl.figure(id, ws_proxy, ondownload, element);

    // Call onopen now - mpl needs it, as it is assuming we've passed it a real
    // web socket which is closed, not our websocket->open comm proxy.
    ws_proxy.onopen();

    fig.parent_element = element;
    fig.cell_info = mpl.find_output_cell("<div id='" + id + "'></div>");
    if (!fig.cell_info) {
        console.error('Failed to find cell for figure', id, fig);
        return;
    }
    fig.cell_info[0].output_area.element.on(
        'cleared',
        { fig: fig },
        fig._remove_fig_handler
    );
};

mpl.figure.prototype.handle_close = function (fig, msg) {
    var width = fig.canvas.width / fig.ratio;
    fig.cell_info[0].output_area.element.off(
        'cleared',
        fig._remove_fig_handler
    );
    fig.resizeObserverInstance.unobserve(fig.canvas_div);

    // Update the output cell to use the data from the current canvas.
    fig.push_to_output();
    var dataURL = fig.canvas.toDataURL();
    // Re-enable the keyboard manager in IPython - without this line, in FF,
    // the notebook keyboard shortcuts fail.
    IPython.keyboard_manager.enable();
    fig.parent_element.innerHTML =
        '<img src="' + dataURL + '" width="' + width + '">';
    fig.close_ws(fig, msg);
};

mpl.figure.prototype.close_ws = function (fig, msg) {
    fig.send_message('closing', msg);
    // fig.ws.close()
};

mpl.figure.prototype.push_to_output = function (_remove_interactive) {
    // Turn the data on the canvas into data in the output cell.
    var width = this.canvas.width / this.ratio;
    var dataURL = this.canvas.toDataURL();
    this.cell_info[1]['text/html'] =
        '<img src="' + dataURL + '" width="' + width + '">';
};

mpl.figure.prototype.updated_canvas_event = function () {
    // Tell IPython that the notebook contents must change.
    IPython.notebook.set_dirty(true);
    this.send_message('ack', {});
    var fig = this;
    // Wait a second, then push the new image to the DOM so
    // that it is saved nicely (might be nice to debounce this).
    setTimeout(function () {
        fig.push_to_output();
    }, 1000);
};

mpl.figure.prototype._init_toolbar = function () {
    var fig = this;

    var toolbar = document.createElement('div');
    toolbar.classList = 'btn-toolbar';
    this.root.appendChild(toolbar);

    function on_click_closure(name) {
        return function (_event) {
            return fig.toolbar_button_onclick(name);
        };
    }

    function on_mouseover_closure(tooltip) {
        return function (event) {
            if (!event.currentTarget.disabled) {
                return fig.toolbar_button_onmouseover(tooltip);
            }
        };
    }

    fig.buttons = {};
    var buttonGroup = document.createElement('div');
    buttonGroup.classList = 'btn-group';
    var button;
    for (var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            /* Instead of a spacer, we start a new button group. */
            if (buttonGroup.hasChildNodes()) {
                toolbar.appendChild(buttonGroup);
            }
            buttonGroup = document.createElement('div');
            buttonGroup.classList = 'btn-group';
            continue;
        }

        button = fig.buttons[name] = document.createElement('button');
        button.classList = 'btn btn-default';
        button.href = '#';
        button.title = name;
        button.innerHTML = '<i class="fa ' + image + ' fa-lg"></i>';
        button.addEventListener('click', on_click_closure(method_name));
        button.addEventListener('mouseover', on_mouseover_closure(tooltip));
        buttonGroup.appendChild(button);
    }

    if (buttonGroup.hasChildNodes()) {
        toolbar.appendChild(buttonGroup);
    }

    // Add the status bar.
    var status_bar = document.createElement('span');
    status_bar.classList = 'mpl-message pull-right';
    toolbar.appendChild(status_bar);
    this.message = status_bar;

    // Add the close button to the window.
    var buttongrp = document.createElement('div');
    buttongrp.classList = 'btn-group inline pull-right';
    button = document.createElement('button');
    button.classList = 'btn btn-mini btn-primary';
    button.href = '#';
    button.title = 'Stop Interaction';
    button.innerHTML = '<i class="fa fa-power-off icon-remove icon-large"></i>';
    button.addEventListener('click', function (_evt) {
        fig.handle_close(fig, {});
    });
    button.addEventListener(
        'mouseover',
        on_mouseover_closure('Stop Interaction')
    );
    buttongrp.appendChild(button);
    var titlebar = this.root.querySelector('.ui-dialog-titlebar');
    titlebar.insertBefore(buttongrp, titlebar.firstChild);
};

mpl.figure.prototype._remove_fig_handler = function (event) {
    var fig = event.data.fig;
    if (event.target !== this) {
        // Ignore bubbled events from children.
        return;
    }
    fig.close_ws(fig, {});
};

mpl.figure.prototype._root_extra_style = function (el) {
    el.style.boxSizing = 'content-box'; // override notebook setting of border-box.
};

mpl.figure.prototype._canvas_extra_style = function (el) {
    // this is important to make the div 'focusable
    el.setAttribute('tabindex', 0);
    // reach out to IPython and tell the keyboard manager to turn it's self
    // off when our div gets focus

    // location in version 3
    if (IPython.notebook.keyboard_manager) {
        IPython.notebook.keyboard_manager.register_events(el);
    } else {
        // location in version 2
        IPython.keyboard_manager.register_events(el);
    }
};

mpl.figure.prototype._key_event_extra = function (event, _name) {
    var manager = IPython.notebook.keyboard_manager;
    if (!manager) {
        manager = IPython.keyboard_manager;
    }

    // Check for shift+enter
    if (event.shiftKey && event.which === 13) {
        this.canvas_div.blur();
        // select the cell after this one
        var index = IPython.notebook.find_cell_index(this.cell_info[0]);
        IPython.notebook.select(index + 1);
    }
};

mpl.figure.prototype.handle_save = function (fig, _msg) {
    fig.ondownload(fig, null);
};

mpl.find_output_cell = function (html_output) {
    // Return the cell and output element which can be found *uniquely* in the notebook.
    // Note - this is a bit hacky, but it is done because the "notebook_saving.Notebook"
    // IPython event is triggered only after the cells have been serialised, which for
    // our purposes (turning an active figure into a static one), is too late.
    var cells = IPython.notebook.get_cells();
    var ncells = cells.length;
    for (var i = 0; i < ncells; i++) {
        var cell = cells[i];
        if (cell.cell_type === 'code') {
            for (var j = 0; j < cell.output_area.outputs.length; j++) {
                var data = cell.output_area.outputs[j];
                if (data.data) {
                    // IPython >= 3 moved mimebundle to data attribute of output
                    data = data.data;
                }
                if (data['text/html'] === html_output) {
                    return [cell, data, j];
                }
            }
        }
    }
};

// Register the function which deals with the matplotlib target/channel.
// The kernel may be null if the page has been refreshed.
if (IPython.notebook.kernel !== null) {
    IPython.notebook.kernel.comm_manager.register_target(
        'matplotlib',
        mpl.mpl_figure_comm
    );
}
</script><div class="output text_html"><div id='1e003ee9-6d34-48b9-b5d7-55f07b3f1fd4'></div></div><script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "16d77b6b149349c2959118b5929a2337"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.&lt;lambda&gt;(v)&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="efficient-implementation-of-z-update-for-isotropic-tv-regularizer">
<h5>Efficient implementation of <span class="math notranslate nohighlight">\(z\)</span>-update for isotropic TV regularizer<a class="headerlink" href="#efficient-implementation-of-z-update-for-isotropic-tv-regularizer" title="Permalink to this headline">#</a></h5>
<p>For the isotropic case, the <span class="math notranslate nohighlight">\(l_2\)</span>-norm of the finite differences approximation of the horizontal and vertical image gradients is used as the regularizer instead of the <span class="math notranslate nohighlight">\(l_1\)</span>-norm, i.e.,
\begin{align}
\lambda \left| \mathbf{z} \right|<em>{2,1}  = \lambda \sum\limits^N</em>{i=1} \left| \left[ \begin{pmatrix}
(\mathbf{D}_x \mathbf{x})_i \ (\mathbf{D}_y \mathbf{x})_i
\end{pmatrix} \right] \right|<em>2 = \lambda \sum\limits^N</em>{i=1} \sqrt{(\mathbf{D}_x \mathbf{x})^2_i + (\mathbf{D}_y \mathbf{x})^2_i } ,.
\end{align}
This expression is also called the <em>group lasso</em>.</p>
<p>Accordingly, the whole deconvolution problem for the isotropic TV regularizer is
\begin{align}
&amp;\argmin{\mathbf{x}} \underbrace{\frac{1}{2} \left| \mathbf{Cx-b} \right|^2_2}<em>{=:f(\mathbf{x})} + \underbrace{\lambda \sum\limits^N</em>{i=1} \left| \left[ \begin{pmatrix}
z_i \ z_{i+N}
\end{pmatrix} \right]  \right|<em>2 }</em>{=:g(\mathbf{z})} \
&amp;\text{subject to } \mathbf{Dx-z=\mathbf{0}},.
\end{align}</p>
<p>Again, the vector <span class="math notranslate nohighlight">\(\mathbf{z} \in \mathbb{R}^{2\times N}\)</span> so that its first, respectively, second half can hold the image gradients in <span class="math notranslate nohighlight">\(x\)</span>-direction, respectively, in <span class="math notranslate nohighlight">\(y\)</span>-direction, i.e., <span class="math notranslate nohighlight">\(\mathbf{z} = \left[ \mathbf{D}_x \mathbf{x}\,\, \mathbf{D}_y \mathbf{x}   \right]\transp \)</span>.</p>
<p>As only the regularization term <span class="math notranslate nohighlight">\(g(\mathbf{z})\)</span> has changed, we only have to derive a corresponding <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>-update rule, i.e., we have to find a solution for the proximal operator
\begin{align}
\mathbf{z} \leftarrow \mathbf{prox}<em>{\left| \cdot \right|</em>{2,1},\rho } (\mathbf{v}) = \argmin{\mathbf{z}},, \lambda \sum\limits^N_{i=1} \left| \left[ \begin{pmatrix}
z_i \ z_{i+N}
\end{pmatrix} \right]  \right|_2  + \frac{\rho}{2} \left| \mathbf{v-z} \right| ^2_2, \quad \mathbf{v=Dx} ,.
\end{align}</p>
<p>Therefore, we again extract the term we have to minimize:
\begin{align}\label{eq:hqs:iso:1}
h(\mathbf{z}) := \lambda \left| \mathbf{z} \right|_2 + \frac{\rho}{2} \left| \mathbf{v-z} \right| ^2_2 ,.
\end{align}</p>
<p>We follow the approach of calculating the gradient of <span class="math notranslate nohighlight">\(h(\mathbf{z})\)</span>, equating it to <span class="math notranslate nohighlight">\(\mathbf{0}\)</span> and solving for <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>.</p>
<p>The gradient of the second term with respect to <span class="math notranslate nohighlight">\(\mathbf{z}\)</span> can be calculated straight forward:
\begin{align}
\nabla_\mathbf{z} \frac{\rho}{2} \left| \mathbf{v-z} \right| ^2_2 = \rho (-\mathbf{v} + \mathbf{z}) ,.
\end{align}</p>
<p>The gradient of the Euclidean norm <span class="math notranslate nohighlight">\(\left\| \mathbf{x} \right\| _2\)</span> is
\begin{align}
\nabla_\mathbf{x} \left| \mathbf{x} \right|_2 = \frac{\mathbf{x}}{\left| \mathbf{x} \right|<em>2 }, \quad \text{for } \mathbf{x} \neq \mathbf{0} ,.
\end{align}
Hence, the gradient of the first term of \eqref{eq:hqs:iso:1} is
\begin{align}
\nabla</em>\mathbf{z} \lambda \left| \mathbf{z} \right| _2 = \lambda \frac{\mathbf{z}}{\left| \mathbf{z} \right|_2 } \quad \text{for } \mathbf{z} \neq \mathbf{0} ,.
\end{align}</p>
<p>So for <span class="math notranslate nohighlight">\(\mathbf{z} \neq \mathbf{0}\)</span>, we will find a <span class="math notranslate nohighlight">\(\hat{\mathbf{z}}\)</span> with <span class="math notranslate nohighlight">\(  \nabla_\mathbf{z} \lbrace h(\mathbf{z}) \rbrace (\hat{\mathbf{z}}) = \mathbf{0}\)</span>:
\begin{align}
\lambda \frac{\mathbf{z}}{\left| \mathbf{z} \right|_2 } +  \rho (-\mathbf{v} + \mathbf{z}) &amp;\overset{!}{=} \mathbf{0} \
\mathbf{z}\left( \frac{\lambda}{\left| \mathbf{z} \right|_2 } + \rho \right) &amp;= \rho \mathbf{v} ,. \label{eq:hqs:iso:2}
\end{align}
We now apply the <span class="math notranslate nohighlight">\(l_2\)</span>-norm to both sides of the equation:
\begin{align}  \label{eq:hqs:iso:3}
\left| \frac{\lambda}{\left| \mathbf{z} \right|_2 }  + \rho\right| \cdot \left| \mathbf{z} \right|_2 = \left| \rho \right|  \left| \mathbf{v} \right|_2 ,.
\end{align}
The last step introduced two absolute values for each of which the two possible cases, .i.e, <span class="math notranslate nohighlight">\(&gt;0\)</span>, <span class="math notranslate nohighlight">\(&lt;0\)</span> have to be considered. Regarding the term <span class="math notranslate nohighlight">\(\left| \rho \right| \)</span> on the right side of the equation, only the positive case has to be considered since <span class="math notranslate nohighlight">\(\rho &gt; 0\)</span> by definition.</p>
<p>The first absolute term <span class="math notranslate nohighlight">\(\left| \frac{\lambda}{\left\| \mathbf{z} \right\|_2 }  + \rho\right|\)</span> is positive if
\begin{align}
\frac{\lambda}{\left| \mathbf{z} \right|_2 }  + \rho &amp;&gt; 0 \</p>
<ul class="simple">
<li><p>\frac{\lambda}{\rho} &amp;&lt; \left| \mathbf{z} \right| _2 ,,
\end{align}
what always holds since due to <span class="math notranslate nohighlight">\(\lambda &gt; 0\)</span> and <span class="math notranslate nohighlight">\(\rho &gt; 0\)</span> it follows <span class="math notranslate nohighlight">\(-\frac{\lambda}{\rho} &lt; 0\)</span> and since  <span class="math notranslate nohighlight">\(\left\| \mathbf{z} \right\| _2 &gt; 0\)</span> as <span class="math notranslate nohighlight">\(\left\| \cdot \right\| \geq 0\)</span> for any norm and <span class="math notranslate nohighlight">\(\mathbf{z} \neq \mathbf{0}\)</span> by definition of the considered case. Hence, the negative case is impossible.</p></li>
</ul>
<p>We continue to solve \eqref{eq:hqs:iso:3} for <span class="math notranslate nohighlight">\(\left\| \mathbf{z} \right\| _2\)</span>:
\begin{align}
\left( \frac{\lambda}{\left| \mathbf{z} \right|_2 }  + \rho\right) \cdot \left| \mathbf{z} \right|_2 &amp;= \rho  \left| \mathbf{v} \right|_2  \
\lambda + \rho \left| \mathbf{z} \right| _2 &amp;= \rho \left| \mathbf{v} \right| _2 \
\left| \mathbf{z} \right| _2 &amp;= \frac{\rho \left| \mathbf{v} \right|_2 - \lambda  }{\rho} ,,
\end{align}
and now insert this expression for <span class="math notranslate nohighlight">\(\left\| \mathbf{z} \right\| _2\)</span> into \eqref{eq:hqs:iso:2} and solve for <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>:
\begin{align}
\mathbf{z} \left( \lambda \cdot \frac{\rho }{\rho \left| \mathbf{v} \right|_2 - \lambda } + \rho  \right) &amp;= \rho \mathbf{v} \
\mathbf{z} \frac{\lambda + \rho  \left| \mathbf{v} \right|_2 - \lambda  }{\rho  \left| \mathbf{v} \right|_2 - \lambda  } &amp;= \mathbf{v}  \
\mathbf{z} &amp;= \mathbf{v} \cdot \frac{\rho  \left| \mathbf{v} \right|_2 - \lambda  }{\rho  \left| \mathbf{v} \right|_2 } \
\mathbf{z} &amp;= \mathbf{v} \cdot \left( 1 - \frac{\lambda }{\rho \left| \mathbf{v} \right|_2 } \right) ,.
\end{align}
In order to make sure that <span class="math notranslate nohighlight">\(\mathbf{z} \overset{!}{\neq} \mathbf{0}\)</span>, we have to check for which conditions <span class="math notranslate nohighlight">\(\left( 1 - \frac{\lambda }{\rho \left\| \mathbf{v} \right\|_2 } \right) &gt; 0\)</span> holds (we do not have to check for <span class="math notranslate nohighlight">\(&lt;0\)</span> as this is impossible as we showed when inspecting the absolute terms before):
\begin{align}
\left( 1 - \frac{\lambda }{\rho \left| \mathbf{v} \right|_2 } \right) &amp;&gt; 0 \
\left| \mathbf{v} \right|_2 &amp;&gt; \frac{\lambda }{\rho } ,.
\end{align}</p>
<p>For <span class="math notranslate nohighlight">\(\mathbf{z} = \mathbf{0}\)</span>, there is no well-defined gradient for <span class="math notranslate nohighlight">\(\left\| \mathbf{z} \right\|_2\)</span>, so we make use of the concept of subdifferentials again and derive the subdifferential of <span class="math notranslate nohighlight">\(h(\mathbf{z})\)</span> with respect to position <span class="math notranslate nohighlight">\(\mathbf{z} = \mathbf{0}\)</span>:
\begin{align}
h(\mathbf{z}) &amp;= \lambda \left| \mathbf{z} \right|<em>2 + \frac{\rho}{2} \left| \mathbf{v-z} \right| ^2_2 \
\frac{h(\mathbf{z})}{\rho} &amp;= \frac{\lambda}{\rho } \left| \mathbf{z} \right|<em>2 + \frac{1}{2} \left| \mathbf{v-z} \right|^2_2  \
\partial</em>\mathbf{0} \frac{h(\mathbf{z})}{\rho} &amp;= \partial</em>\mathbf{0} \frac{\lambda}{\rho } \left| \mathbf{z} \right|<em>2 \oplus  \partial</em>\mathbf{0}\frac{1}{2} \left| \mathbf{v-z} \right|^2_2 ,.
\end{align}
As before, we can replace the second subdifferential on the right side of the equation with the true gradient:
\begin{align}
\partial_\mathbf{0} \frac{h(\mathbf{z})}{\rho} &amp;= \partial_\mathbf{0} \frac{\lambda}{\rho } \left| \mathbf{z} \right|<em>2 \oplus  \lbrace - \mathbf{v} \rbrace ,.
\end{align}
For the first term, i.e., <span class="math notranslate nohighlight">\(\partial_\mathbf{0}\frac{\lambda}{\rho} \left\| \mathbf{z} \right\|_2\)</span>, we employ the definition of subdifferentials:
\begin{align}
\partial</em>\mathbf{0}\frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 &amp;= \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 \geq \frac{\lambda}{\rho} \left| \mathbf{0} \right|<em>2 + \left\langle \mathbf{g} , \mathbf{z} - \mathbf{0}\right\rangle  \right} \
\partial</em>\mathbf{0}\frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 &amp;= \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho} \left| \mathbf{z} \right|<em>2 \geq \left\langle \mathbf{g} , \mathbf{z}\right\rangle  \right} ,.
\end{align}
By means of the Cauchy-Schwarz inequality, i.e., <span class="math notranslate nohighlight">\(\left\langle \mathbf{g}, \mathbf{z} \right\rangle \leq \left\| \mathbf{g} \right\| \cdot \left\| \mathbf{z} \right\| \)</span>, we can further simplify the derivation:
\begin{align}
\partial</em>\mathbf{0}\frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 &amp;= \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 \geq \left\langle \mathbf{g} , \mathbf{z}\right\rangle  \right} \
&amp;= \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho} \left| \mathbf{z} \right|_2 \geq \left| \mathbf{g} \right|_2 \cdot \left| \mathbf{z} \right|_2     \right} \
&amp;= \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho}  \geq \left| \mathbf{g} \right|<em>2      \right} ,.
\end{align}
The resulting combined expression for the subdifferential of <span class="math notranslate nohighlight">\(\frac{h(\mathbf{z})}{\rho} \)</span> is:
\begin{align}
\partial</em>\mathbf{0}\frac{h(\mathbf{z})}{\rho} = \left{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho}  \geq \left| \mathbf{g} \right|_2      \right} \oplus \lbrace -\mathbf{v} \rbrace ,.
\end{align}
For <span class="math notranslate nohighlight">\(\mathbf{z} = \mathbf{0}\)</span> we want to return <span class="math notranslate nohighlight">\(\mathbf{0}\)</span> if possible since that would correspond to the sought minimum. A subgradient <span class="math notranslate nohighlight">\(\mathbf{0}\)</span> is contained in <span class="math notranslate nohighlight">\(\partial_\mathbf{0}\frac{h(\mathbf{z})}{\rho}\)</span> if the first subdifferential <span class="math notranslate nohighlight">\(\left\{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho}  \geq \left\| \mathbf{g} \right\|_2      \right\}\)</span> contains a vector <span class="math notranslate nohighlight">\(\mathbf{g}\)</span> with <span class="math notranslate nohighlight">\(\mathbf{g} = \mathbf{v}\)</span> because then the Minkowski sum <span class="math notranslate nohighlight">\(\left\{ \mathbf{g} \in \mathbb{R}^{2N} : \frac{\lambda}{\rho}  \geq \left\| \mathbf{g} \right\|_2      \right\} \oplus \lbrace -\mathbf{v} \rbrace\)</span> would contain <span class="math notranslate nohighlight">\(\mathbf{0}\)</span>. This is only possible for any vectors <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> with <span class="math notranslate nohighlight">\(\left\| \mathbf{v} \right\|_2 \leq \frac{\lambda}{\rho}  \)</span>.</p>
<p>With these results, the final <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>-update rule is given by:</p>
<p>\begin{align}
\mathbf{z} \leftarrow \mathbf{prox}<em>{\left| \cdot \right|</em>{2,1},\rho } (\mathbf{v}) = \begin{cases}
\mathbf{v} \cdot \left( 1 - \frac{\lambda }{\rho \left| \mathbf{v} \right|_2 } \right) &amp;\text{if } \left| \mathbf{v} \right| _2 &gt; \frac{\lambda}{\rho} \
\mathbf{0} &amp;\text{if } \left| \mathbf{v} \right| _2 \leq \frac{\lambda}{\rho}
\end{cases}
,.
\end{align}
This expression is also known as the vector soft-thresholding operator.</p>
</section>
</section>
</section>
</section>
</section>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"c6209304458346d7b736ceb1c01d35a4": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "8aa3016b8436407bb35a85bfedfa64f8": {"model_name": "SliderStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "SliderStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": "", "handle_color": null}}, "17876d61a8b54464b09bab808a26a3b1": {"model_name": "IntSliderModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "IntSliderModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "IntSliderView", "continuous_update": true, "description": "i", "description_tooltip": null, "disabled": false, "layout": "IPY_MODEL_c6209304458346d7b736ceb1c01d35a4", "max": 16, "min": 0, "orientation": "horizontal", "readout": true, "readout_format": "d", "step": 1, "style": "IPY_MODEL_8aa3016b8436407bb35a85bfedfa64f8", "value": 1}}, "360daf8ee3b14a3fae157d8f14e33928": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "c5148f88e7264e97b168f5041ac41784": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_17876d61a8b54464b09bab808a26a3b1", "IPY_MODEL_ee4217e941c04a6689c5936052b0142a"], "layout": "IPY_MODEL_360daf8ee3b14a3fae157d8f14e33928"}}, "296774f939654ca190ad1c136c97363d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ee4217e941c04a6689c5936052b0142a": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_296774f939654ca190ad1c136c97363d", "msg_id": "", "outputs": [{"output_type": "display_data", "metadata": {}, "data": {"text/plain": "<IPython.core.display.Javascript object>", "application/javascript": "/* Put everything inside the global mpl namespace */\n/* global mpl */\nwindow.mpl = {};\n\nmpl.get_websocket_type = function () {\n    if (typeof WebSocket !== 'undefined') {\n        return WebSocket;\n    } else if (typeof MozWebSocket !== 'undefined') {\n        return MozWebSocket;\n    } else {\n        alert(\n            'Your browser does not have WebSocket support. ' +\n                'Please try Chrome, Safari or Firefox \u2265 6. ' +\n                'Firefox 4 and 5 are also supported but you ' +\n                'have to enable WebSockets in about:config.'\n        );\n    }\n};\n\nmpl.figure = function (figure_id, websocket, ondownload, parent_element) {\n    this.id = figure_id;\n\n    this.ws = websocket;\n\n    this.supports_binary = this.ws.binaryType !== undefined;\n\n    if (!this.supports_binary) {\n        var warnings = document.getElementById('mpl-warnings');\n        if (warnings) {\n            warnings.style.display = 'block';\n            warnings.textContent =\n                'This browser does not support binary websocket messages. ' +\n                'Performance may be slow.';\n        }\n    }\n\n    this.imageObj = new Image();\n\n    this.context = undefined;\n    this.message = undefined;\n    this.canvas = undefined;\n    this.rubberband_canvas = undefined;\n    this.rubberband_context = undefined;\n    this.format_dropdown = undefined;\n\n    this.image_mode = 'full';\n\n    this.root = document.createElement('div');\n    this.root.setAttribute('style', 'display: inline-block');\n    this._root_extra_style(this.root);\n\n    parent_element.appendChild(this.root);\n\n    this._init_header(this);\n    this._init_canvas(this);\n    this._init_toolbar(this);\n\n    var fig = this;\n\n    this.waiting = false;\n\n    this.ws.onopen = function () {\n        fig.send_message('supports_binary', { value: fig.supports_binary });\n        fig.send_message('send_image_mode', {});\n        if (fig.ratio !== 1) {\n            fig.send_message('set_dpi_ratio', { dpi_ratio: fig.ratio });\n        }\n        fig.send_message('refresh', {});\n    };\n\n    this.imageObj.onload = function () {\n        if (fig.image_mode === 'full') {\n            // Full images could contain transparency (where diff images\n            // almost always do), so we need to clear the canvas so that\n            // there is no ghosting.\n            fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);\n        }\n        fig.context.drawImage(fig.imageObj, 0, 0);\n    };\n\n    this.imageObj.onunload = function () {\n        fig.ws.close();\n    };\n\n    this.ws.onmessage = this._make_on_message_function(this);\n\n    this.ondownload = ondownload;\n};\n\nmpl.figure.prototype._init_header = function () {\n    var titlebar = document.createElement('div');\n    titlebar.classList =\n        'ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix';\n    var titletext = document.createElement('div');\n    titletext.classList = 'ui-dialog-title';\n    titletext.setAttribute(\n        'style',\n        'width: 100%; text-align: center; padding: 3px;'\n    );\n    titlebar.appendChild(titletext);\n    this.root.appendChild(titlebar);\n    this.header = titletext;\n};\n\nmpl.figure.prototype._canvas_extra_style = function (_canvas_div) {};\n\nmpl.figure.prototype._root_extra_style = function (_canvas_div) {};\n\nmpl.figure.prototype._init_canvas = function () {\n    var fig = this;\n\n    var canvas_div = (this.canvas_div = document.createElement('div'));\n    canvas_div.setAttribute(\n        'style',\n        'border: 1px solid #ddd;' +\n            'box-sizing: content-box;' +\n            'clear: both;' +\n            'min-height: 1px;' +\n            'min-width: 1px;' +\n            'outline: 0;' +\n            'overflow: hidden;' +\n            'position: relative;' +\n            'resize: both;'\n    );\n\n    function on_keyboard_event_closure(name) {\n        return function (event) {\n            return fig.key_event(event, name);\n        };\n    }\n\n    canvas_div.addEventListener(\n        'keydown',\n        on_keyboard_event_closure('key_press')\n    );\n    canvas_div.addEventListener(\n        'keyup',\n        on_keyboard_event_closure('key_release')\n    );\n\n    this._canvas_extra_style(canvas_div);\n    this.root.appendChild(canvas_div);\n\n    var canvas = (this.canvas = document.createElement('canvas'));\n    canvas.classList.add('mpl-canvas');\n    canvas.setAttribute('style', 'box-sizing: content-box;');\n\n    this.context = canvas.getContext('2d');\n\n    var backingStore =\n        this.context.backingStorePixelRatio ||\n        this.context.webkitBackingStorePixelRatio ||\n        this.context.mozBackingStorePixelRatio ||\n        this.context.msBackingStorePixelRatio ||\n        this.context.oBackingStorePixelRatio ||\n        this.context.backingStorePixelRatio ||\n        1;\n\n    this.ratio = (window.devicePixelRatio || 1) / backingStore;\n\n    var rubberband_canvas = (this.rubberband_canvas = document.createElement(\n        'canvas'\n    ));\n    rubberband_canvas.setAttribute(\n        'style',\n        'box-sizing: content-box; position: absolute; left: 0; top: 0; z-index: 1;'\n    );\n\n    // Apply a ponyfill if ResizeObserver is not implemented by browser.\n    if (this.ResizeObserver === undefined) {\n        if (window.ResizeObserver !== undefined) {\n            this.ResizeObserver = window.ResizeObserver;\n        } else {\n            var obs = _JSXTOOLS_RESIZE_OBSERVER({});\n            this.ResizeObserver = obs.ResizeObserver;\n        }\n    }\n\n    this.resizeObserverInstance = new this.ResizeObserver(function (entries) {\n        var nentries = entries.length;\n        for (var i = 0; i < nentries; i++) {\n            var entry = entries[i];\n            var width, height;\n            if (entry.contentBoxSize) {\n                if (entry.contentBoxSize instanceof Array) {\n                    // Chrome 84 implements new version of spec.\n                    width = entry.contentBoxSize[0].inlineSize;\n                    height = entry.contentBoxSize[0].blockSize;\n                } else {\n                    // Firefox implements old version of spec.\n                    width = entry.contentBoxSize.inlineSize;\n                    height = entry.contentBoxSize.blockSize;\n                }\n            } else {\n                // Chrome <84 implements even older version of spec.\n                width = entry.contentRect.width;\n                height = entry.contentRect.height;\n            }\n\n            // Keep the size of the canvas and rubber band canvas in sync with\n            // the canvas container.\n            if (entry.devicePixelContentBoxSize) {\n                // Chrome 84 implements new version of spec.\n                canvas.setAttribute(\n                    'width',\n                    entry.devicePixelContentBoxSize[0].inlineSize\n                );\n                canvas.setAttribute(\n                    'height',\n                    entry.devicePixelContentBoxSize[0].blockSize\n                );\n            } else {\n                canvas.setAttribute('width', width * fig.ratio);\n                canvas.setAttribute('height', height * fig.ratio);\n            }\n            canvas.setAttribute(\n                'style',\n                'width: ' + width + 'px; height: ' + height + 'px;'\n            );\n\n            rubberband_canvas.setAttribute('width', width);\n            rubberband_canvas.setAttribute('height', height);\n\n            // And update the size in Python. We ignore the initial 0/0 size\n            // that occurs as the element is placed into the DOM, which should\n            // otherwise not happen due to the minimum size styling.\n            if (fig.ws.readyState == 1 && width != 0 && height != 0) {\n                fig.request_resize(width, height);\n            }\n        }\n    });\n    this.resizeObserverInstance.observe(canvas_div);\n\n    function on_mouse_event_closure(name) {\n        return function (event) {\n            return fig.mouse_event(event, name);\n        };\n    }\n\n    rubberband_canvas.addEventListener(\n        'mousedown',\n        on_mouse_event_closure('button_press')\n    );\n    rubberband_canvas.addEventListener(\n        'mouseup',\n        on_mouse_event_closure('button_release')\n    );\n    rubberband_canvas.addEventListener(\n        'dblclick',\n        on_mouse_event_closure('dblclick')\n    );\n    // Throttle sequential mouse events to 1 every 20ms.\n    rubberband_canvas.addEventListener(\n        'mousemove',\n        on_mouse_event_closure('motion_notify')\n    );\n\n    rubberband_canvas.addEventListener(\n        'mouseenter',\n        on_mouse_event_closure('figure_enter')\n    );\n    rubberband_canvas.addEventListener(\n        'mouseleave',\n        on_mouse_event_closure('figure_leave')\n    );\n\n    canvas_div.addEventListener('wheel', function (event) {\n        if (event.deltaY < 0) {\n            event.step = 1;\n        } else {\n            event.step = -1;\n        }\n        on_mouse_event_closure('scroll')(event);\n    });\n\n    canvas_div.appendChild(canvas);\n    canvas_div.appendChild(rubberband_canvas);\n\n    this.rubberband_context = rubberband_canvas.getContext('2d');\n    this.rubberband_context.strokeStyle = '#000000';\n\n    this._resize_canvas = function (width, height, forward) {\n        if (forward) {\n            canvas_div.style.width = width + 'px';\n            canvas_div.style.height = height + 'px';\n        }\n    };\n\n    // Disable right mouse context menu.\n    this.rubberband_canvas.addEventListener('contextmenu', function (_e) {\n        event.preventDefault();\n        return false;\n    });\n\n    function set_focus() {\n        canvas.focus();\n        canvas_div.focus();\n    }\n\n    window.setTimeout(set_focus, 100);\n};\n\nmpl.figure.prototype._init_toolbar = function () {\n    var fig = this;\n\n    var toolbar = document.createElement('div');\n    toolbar.classList = 'mpl-toolbar';\n    this.root.appendChild(toolbar);\n\n    function on_click_closure(name) {\n        return function (_event) {\n            return fig.toolbar_button_onclick(name);\n        };\n    }\n\n    function on_mouseover_closure(tooltip) {\n        return function (event) {\n            if (!event.currentTarget.disabled) {\n                return fig.toolbar_button_onmouseover(tooltip);\n            }\n        };\n    }\n\n    fig.buttons = {};\n    var buttonGroup = document.createElement('div');\n    buttonGroup.classList = 'mpl-button-group';\n    for (var toolbar_ind in mpl.toolbar_items) {\n        var name = mpl.toolbar_items[toolbar_ind][0];\n        var tooltip = mpl.toolbar_items[toolbar_ind][1];\n        var image = mpl.toolbar_items[toolbar_ind][2];\n        var method_name = mpl.toolbar_items[toolbar_ind][3];\n\n        if (!name) {\n            /* Instead of a spacer, we start a new button group. */\n            if (buttonGroup.hasChildNodes()) {\n                toolbar.appendChild(buttonGroup);\n            }\n            buttonGroup = document.createElement('div');\n            buttonGroup.classList = 'mpl-button-group';\n            continue;\n        }\n\n        var button = (fig.buttons[name] = document.createElement('button'));\n        button.classList = 'mpl-widget';\n        button.setAttribute('role', 'button');\n        button.setAttribute('aria-disabled', 'false');\n        button.addEventListener('click', on_click_closure(method_name));\n        button.addEventListener('mouseover', on_mouseover_closure(tooltip));\n\n        var icon_img = document.createElement('img');\n        icon_img.src = '_images/' + image + '.png';\n        icon_img.srcset = '_images/' + image + '_large.png 2x';\n        icon_img.alt = tooltip;\n        button.appendChild(icon_img);\n\n        buttonGroup.appendChild(button);\n    }\n\n    if (buttonGroup.hasChildNodes()) {\n        toolbar.appendChild(buttonGroup);\n    }\n\n    var fmt_picker = document.createElement('select');\n    fmt_picker.classList = 'mpl-widget';\n    toolbar.appendChild(fmt_picker);\n    this.format_dropdown = fmt_picker;\n\n    for (var ind in mpl.extensions) {\n        var fmt = mpl.extensions[ind];\n        var option = document.createElement('option');\n        option.selected = fmt === mpl.default_extension;\n        option.innerHTML = fmt;\n        fmt_picker.appendChild(option);\n    }\n\n    var status_bar = document.createElement('span');\n    status_bar.classList = 'mpl-message';\n    toolbar.appendChild(status_bar);\n    this.message = status_bar;\n};\n\nmpl.figure.prototype.request_resize = function (x_pixels, y_pixels) {\n    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,\n    // which will in turn request a refresh of the image.\n    this.send_message('resize', { width: x_pixels, height: y_pixels });\n};\n\nmpl.figure.prototype.send_message = function (type, properties) {\n    properties['type'] = type;\n    properties['figure_id'] = this.id;\n    this.ws.send(JSON.stringify(properties));\n};\n\nmpl.figure.prototype.send_draw_message = function () {\n    if (!this.waiting) {\n        this.waiting = true;\n        this.ws.send(JSON.stringify({ type: 'draw', figure_id: this.id }));\n    }\n};\n\nmpl.figure.prototype.handle_save = function (fig, _msg) {\n    var format_dropdown = fig.format_dropdown;\n    var format = format_dropdown.options[format_dropdown.selectedIndex].value;\n    fig.ondownload(fig, format);\n};\n\nmpl.figure.prototype.handle_resize = function (fig, msg) {\n    var size = msg['size'];\n    if (size[0] !== fig.canvas.width || size[1] !== fig.canvas.height) {\n        fig._resize_canvas(size[0], size[1], msg['forward']);\n        fig.send_message('refresh', {});\n    }\n};\n\nmpl.figure.prototype.handle_rubberband = function (fig, msg) {\n    var x0 = msg['x0'] / fig.ratio;\n    var y0 = (fig.canvas.height - msg['y0']) / fig.ratio;\n    var x1 = msg['x1'] / fig.ratio;\n    var y1 = (fig.canvas.height - msg['y1']) / fig.ratio;\n    x0 = Math.floor(x0) + 0.5;\n    y0 = Math.floor(y0) + 0.5;\n    x1 = Math.floor(x1) + 0.5;\n    y1 = Math.floor(y1) + 0.5;\n    var min_x = Math.min(x0, x1);\n    var min_y = Math.min(y0, y1);\n    var width = Math.abs(x1 - x0);\n    var height = Math.abs(y1 - y0);\n\n    fig.rubberband_context.clearRect(\n        0,\n        0,\n        fig.canvas.width / fig.ratio,\n        fig.canvas.height / fig.ratio\n    );\n\n    fig.rubberband_context.strokeRect(min_x, min_y, width, height);\n};\n\nmpl.figure.prototype.handle_figure_label = function (fig, msg) {\n    // Updates the figure title.\n    fig.header.textContent = msg['label'];\n};\n\nmpl.figure.prototype.handle_cursor = function (fig, msg) {\n    var cursor = msg['cursor'];\n    switch (cursor) {\n        case 0:\n            cursor = 'pointer';\n            break;\n        case 1:\n            cursor = 'default';\n            break;\n        case 2:\n            cursor = 'crosshair';\n            break;\n        case 3:\n            cursor = 'move';\n            break;\n    }\n    fig.rubberband_canvas.style.cursor = cursor;\n};\n\nmpl.figure.prototype.handle_message = function (fig, msg) {\n    fig.message.textContent = msg['message'];\n};\n\nmpl.figure.prototype.handle_draw = function (fig, _msg) {\n    // Request the server to send over a new figure.\n    fig.send_draw_message();\n};\n\nmpl.figure.prototype.handle_image_mode = function (fig, msg) {\n    fig.image_mode = msg['mode'];\n};\n\nmpl.figure.prototype.handle_history_buttons = function (fig, msg) {\n    for (var key in msg) {\n        if (!(key in fig.buttons)) {\n            continue;\n        }\n        fig.buttons[key].disabled = !msg[key];\n        fig.buttons[key].setAttribute('aria-disabled', !msg[key]);\n    }\n};\n\nmpl.figure.prototype.handle_navigate_mode = function (fig, msg) {\n    if (msg['mode'] === 'PAN') {\n        fig.buttons['Pan'].classList.add('active');\n        fig.buttons['Zoom'].classList.remove('active');\n    } else if (msg['mode'] === 'ZOOM') {\n        fig.buttons['Pan'].classList.remove('active');\n        fig.buttons['Zoom'].classList.add('active');\n    } else {\n        fig.buttons['Pan'].classList.remove('active');\n        fig.buttons['Zoom'].classList.remove('active');\n    }\n};\n\nmpl.figure.prototype.updated_canvas_event = function () {\n    // Called whenever the canvas gets updated.\n    this.send_message('ack', {});\n};\n\n// A function to construct a web socket function for onmessage handling.\n// Called in the figure constructor.\nmpl.figure.prototype._make_on_message_function = function (fig) {\n    return function socket_on_message(evt) {\n        if (evt.data instanceof Blob) {\n            var img = evt.data;\n            if (img.type !== 'image/png') {\n                /* FIXME: We get \"Resource interpreted as Image but\n                 * transferred with MIME type text/plain:\" errors on\n                 * Chrome.  But how to set the MIME type?  It doesn't seem\n                 * to be part of the websocket stream */\n                img.type = 'image/png';\n            }\n\n            /* Free the memory for the previous frames */\n            if (fig.imageObj.src) {\n                (window.URL || window.webkitURL).revokeObjectURL(\n                    fig.imageObj.src\n                );\n            }\n\n            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(\n                img\n            );\n            fig.updated_canvas_event();\n            fig.waiting = false;\n            return;\n        } else if (\n            typeof evt.data === 'string' &&\n            evt.data.slice(0, 21) === 'data:image/png;base64'\n        ) {\n            fig.imageObj.src = evt.data;\n            fig.updated_canvas_event();\n            fig.waiting = false;\n            return;\n        }\n\n        var msg = JSON.parse(evt.data);\n        var msg_type = msg['type'];\n\n        // Call the  \"handle_{type}\" callback, which takes\n        // the figure and JSON message as its only arguments.\n        try {\n            var callback = fig['handle_' + msg_type];\n        } catch (e) {\n            console.log(\n                \"No handler for the '\" + msg_type + \"' message type: \",\n                msg\n            );\n            return;\n        }\n\n        if (callback) {\n            try {\n                // console.log(\"Handling '\" + msg_type + \"' message: \", msg);\n                callback(fig, msg);\n            } catch (e) {\n                console.log(\n                    \"Exception inside the 'handler_\" + msg_type + \"' callback:\",\n                    e,\n                    e.stack,\n                    msg\n                );\n            }\n        }\n    };\n};\n\n// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas\nmpl.findpos = function (e) {\n    //this section is from http://www.quirksmode.org/js/events_properties.html\n    var targ;\n    if (!e) {\n        e = window.event;\n    }\n    if (e.target) {\n        targ = e.target;\n    } else if (e.srcElement) {\n        targ = e.srcElement;\n    }\n    if (targ.nodeType === 3) {\n        // defeat Safari bug\n        targ = targ.parentNode;\n    }\n\n    // pageX,Y are the mouse positions relative to the document\n    var boundingRect = targ.getBoundingClientRect();\n    var x = e.pageX - (boundingRect.left + document.body.scrollLeft);\n    var y = e.pageY - (boundingRect.top + document.body.scrollTop);\n\n    return { x: x, y: y };\n};\n\n/*\n * return a copy of an object with only non-object keys\n * we need this to avoid circular references\n * http://stackoverflow.com/a/24161582/3208463\n */\nfunction simpleKeys(original) {\n    return Object.keys(original).reduce(function (obj, key) {\n        if (typeof original[key] !== 'object') {\n            obj[key] = original[key];\n        }\n        return obj;\n    }, {});\n}\n\nmpl.figure.prototype.mouse_event = function (event, name) {\n    var canvas_pos = mpl.findpos(event);\n\n    if (name === 'button_press') {\n        this.canvas.focus();\n        this.canvas_div.focus();\n    }\n\n    var x = canvas_pos.x * this.ratio;\n    var y = canvas_pos.y * this.ratio;\n\n    this.send_message(name, {\n        x: x,\n        y: y,\n        button: event.button,\n        step: event.step,\n        guiEvent: simpleKeys(event),\n    });\n\n    /* This prevents the web browser from automatically changing to\n     * the text insertion cursor when the button is pressed.  We want\n     * to control all of the cursor setting manually through the\n     * 'cursor' event from matplotlib */\n    event.preventDefault();\n    return false;\n};\n\nmpl.figure.prototype._key_event_extra = function (_event, _name) {\n    // Handle any extra behaviour associated with a key event\n};\n\nmpl.figure.prototype.key_event = function (event, name) {\n    // Prevent repeat events\n    if (name === 'key_press') {\n        if (event.key === this._key) {\n            return;\n        } else {\n            this._key = event.key;\n        }\n    }\n    if (name === 'key_release') {\n        this._key = null;\n    }\n\n    var value = '';\n    if (event.ctrlKey && event.key !== 'Control') {\n        value += 'ctrl+';\n    }\n    else if (event.altKey && event.key !== 'Alt') {\n        value += 'alt+';\n    }\n    else if (event.shiftKey && event.key !== 'Shift') {\n        value += 'shift+';\n    }\n\n    value += 'k' + event.key;\n\n    this._key_event_extra(event, name);\n\n    this.send_message(name, { key: value, guiEvent: simpleKeys(event) });\n    return false;\n};\n\nmpl.figure.prototype.toolbar_button_onclick = function (name) {\n    if (name === 'download') {\n        this.handle_save(this, null);\n    } else {\n        this.send_message('toolbar_button', { name: name });\n    }\n};\n\nmpl.figure.prototype.toolbar_button_onmouseover = function (tooltip) {\n    this.message.textContent = tooltip;\n};\n\n///////////////// REMAINING CONTENT GENERATED BY embed_js.py /////////////////\n// prettier-ignore\nvar _JSXTOOLS_RESIZE_OBSERVER=function(A){var t,i=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,o=new Set;function s(e){if(!(this instanceof s))throw new TypeError(\"Constructor requires 'new' operator\");i.set(this,e)}function h(){throw new TypeError(\"Function is not a constructor\")}function c(e,t,i,n){e=0 in arguments?Number(arguments[0]):0,t=1 in arguments?Number(arguments[1]):0,i=2 in arguments?Number(arguments[2]):0,n=3 in arguments?Number(arguments[3]):0,this.right=(this.x=this.left=e)+(this.width=i),this.bottom=(this.y=this.top=t)+(this.height=n),Object.freeze(this)}function d(){t=requestAnimationFrame(d);var s=new WeakMap,p=new Set;o.forEach((function(t){r.get(t).forEach((function(i){var r=t instanceof window.SVGElement,o=a.get(t),d=r?0:parseFloat(o.paddingTop),f=r?0:parseFloat(o.paddingRight),l=r?0:parseFloat(o.paddingBottom),u=r?0:parseFloat(o.paddingLeft),g=r?0:parseFloat(o.borderTopWidth),m=r?0:parseFloat(o.borderRightWidth),w=r?0:parseFloat(o.borderBottomWidth),b=u+f,F=d+l,v=(r?0:parseFloat(o.borderLeftWidth))+m,W=g+w,y=r?0:t.offsetHeight-W-t.clientHeight,E=r?0:t.offsetWidth-v-t.clientWidth,R=b+v,z=F+W,M=r?t.width:parseFloat(o.width)-R-E,O=r?t.height:parseFloat(o.height)-z-y;if(n.has(t)){var k=n.get(t);if(k[0]===M&&k[1]===O)return}n.set(t,[M,O]);var S=Object.create(h.prototype);S.target=t,S.contentRect=new c(u,d,M,O),s.has(i)||(s.set(i,[]),p.add(i)),s.get(i).push(S)}))})),p.forEach((function(e){i.get(e).call(e,s.get(e),e)}))}return s.prototype.observe=function(i){if(i instanceof window.Element){r.has(i)||(r.set(i,new Set),o.add(i),a.set(i,window.getComputedStyle(i)));var n=r.get(i);n.has(this)||n.add(this),cancelAnimationFrame(t),t=requestAnimationFrame(d)}},s.prototype.unobserve=function(i){if(i instanceof window.Element&&r.has(i)){var n=r.get(i);n.has(this)&&(n.delete(this),n.size||(r.delete(i),o.delete(i))),n.size||r.delete(i),o.size||cancelAnimationFrame(t)}},A.DOMRectReadOnly=c,A.ResizeObserver=s,A.ResizeObserverEntry=h,A}; // eslint-disable-line\nmpl.toolbar_items = [[\"Home\", \"Reset original view\", \"fa fa-home icon-home\", \"home\"], [\"Back\", \"Back to previous view\", \"fa fa-arrow-left icon-arrow-left\", \"back\"], [\"Forward\", \"Forward to next view\", \"fa fa-arrow-right icon-arrow-right\", \"forward\"], [\"\", \"\", \"\", \"\"], [\"Pan\", \"Left button pans, Right button zooms\\nx/y fixes axis, CTRL fixes aspect\", \"fa fa-arrows icon-move\", \"pan\"], [\"Zoom\", \"Zoom to rectangle\\nx/y fixes axis, CTRL fixes aspect\", \"fa fa-square-o icon-check-empty\", \"zoom\"], [\"\", \"\", \"\", \"\"], [\"Download\", \"Download plot\", \"fa fa-floppy-o icon-save\", \"download\"]];\n\nmpl.extensions = [\"eps\", \"jpeg\", \"pgf\", \"pdf\", \"png\", \"ps\", \"raw\", \"svg\", \"tif\"];\n\nmpl.default_extension = \"png\";/* global mpl */\n\nvar comm_websocket_adapter = function (comm) {\n    // Create a \"websocket\"-like object which calls the given IPython comm\n    // object with the appropriate methods. Currently this is a non binary\n    // socket, so there is still some room for performance tuning.\n    var ws = {};\n\n    ws.binaryType = comm.kernel.ws.binaryType;\n    ws.readyState = comm.kernel.ws.readyState;\n    function updateReadyState(_event) {\n        if (comm.kernel.ws) {\n            ws.readyState = comm.kernel.ws.readyState;\n        } else {\n            ws.readyState = 3; // Closed state.\n        }\n    }\n    comm.kernel.ws.addEventListener('open', updateReadyState);\n    comm.kernel.ws.addEventListener('close', updateReadyState);\n    comm.kernel.ws.addEventListener('error', updateReadyState);\n\n    ws.close = function () {\n        comm.close();\n    };\n    ws.send = function (m) {\n        //console.log('sending', m);\n        comm.send(m);\n    };\n    // Register the callback with on_msg.\n    comm.on_msg(function (msg) {\n        //console.log('receiving', msg['content']['data'], msg);\n        var data = msg['content']['data'];\n        if (data['blob'] !== undefined) {\n            data = {\n                data: new Blob(msg['buffers'], { type: data['blob'] }),\n            };\n        }\n        // Pass the mpl event to the overridden (by mpl) onmessage function.\n        ws.onmessage(data);\n    });\n    return ws;\n};\n\nmpl.mpl_figure_comm = function (comm, msg) {\n    // This is the function which gets called when the mpl process\n    // starts-up an IPython Comm through the \"matplotlib\" channel.\n\n    var id = msg.content.data.id;\n    // Get hold of the div created by the display call when the Comm\n    // socket was opened in Python.\n    var element = document.getElementById(id);\n    var ws_proxy = comm_websocket_adapter(comm);\n\n    function ondownload(figure, _format) {\n        window.open(figure.canvas.toDataURL());\n    }\n\n    var fig = new mpl.figure(id, ws_proxy, ondownload, element);\n\n    // Call onopen now - mpl needs it, as it is assuming we've passed it a real\n    // web socket which is closed, not our websocket->open comm proxy.\n    ws_proxy.onopen();\n\n    fig.parent_element = element;\n    fig.cell_info = mpl.find_output_cell(\"<div id='\" + id + \"'></div>\");\n    if (!fig.cell_info) {\n        console.error('Failed to find cell for figure', id, fig);\n        return;\n    }\n    fig.cell_info[0].output_area.element.on(\n        'cleared',\n        { fig: fig },\n        fig._remove_fig_handler\n    );\n};\n\nmpl.figure.prototype.handle_close = function (fig, msg) {\n    var width = fig.canvas.width / fig.ratio;\n    fig.cell_info[0].output_area.element.off(\n        'cleared',\n        fig._remove_fig_handler\n    );\n    fig.resizeObserverInstance.unobserve(fig.canvas_div);\n\n    // Update the output cell to use the data from the current canvas.\n    fig.push_to_output();\n    var dataURL = fig.canvas.toDataURL();\n    // Re-enable the keyboard manager in IPython - without this line, in FF,\n    // the notebook keyboard shortcuts fail.\n    IPython.keyboard_manager.enable();\n    fig.parent_element.innerHTML =\n        '<img src=\"' + dataURL + '\" width=\"' + width + '\">';\n    fig.close_ws(fig, msg);\n};\n\nmpl.figure.prototype.close_ws = function (fig, msg) {\n    fig.send_message('closing', msg);\n    // fig.ws.close()\n};\n\nmpl.figure.prototype.push_to_output = function (_remove_interactive) {\n    // Turn the data on the canvas into data in the output cell.\n    var width = this.canvas.width / this.ratio;\n    var dataURL = this.canvas.toDataURL();\n    this.cell_info[1]['text/html'] =\n        '<img src=\"' + dataURL + '\" width=\"' + width + '\">';\n};\n\nmpl.figure.prototype.updated_canvas_event = function () {\n    // Tell IPython that the notebook contents must change.\n    IPython.notebook.set_dirty(true);\n    this.send_message('ack', {});\n    var fig = this;\n    // Wait a second, then push the new image to the DOM so\n    // that it is saved nicely (might be nice to debounce this).\n    setTimeout(function () {\n        fig.push_to_output();\n    }, 1000);\n};\n\nmpl.figure.prototype._init_toolbar = function () {\n    var fig = this;\n\n    var toolbar = document.createElement('div');\n    toolbar.classList = 'btn-toolbar';\n    this.root.appendChild(toolbar);\n\n    function on_click_closure(name) {\n        return function (_event) {\n            return fig.toolbar_button_onclick(name);\n        };\n    }\n\n    function on_mouseover_closure(tooltip) {\n        return function (event) {\n            if (!event.currentTarget.disabled) {\n                return fig.toolbar_button_onmouseover(tooltip);\n            }\n        };\n    }\n\n    fig.buttons = {};\n    var buttonGroup = document.createElement('div');\n    buttonGroup.classList = 'btn-group';\n    var button;\n    for (var toolbar_ind in mpl.toolbar_items) {\n        var name = mpl.toolbar_items[toolbar_ind][0];\n        var tooltip = mpl.toolbar_items[toolbar_ind][1];\n        var image = mpl.toolbar_items[toolbar_ind][2];\n        var method_name = mpl.toolbar_items[toolbar_ind][3];\n\n        if (!name) {\n            /* Instead of a spacer, we start a new button group. */\n            if (buttonGroup.hasChildNodes()) {\n                toolbar.appendChild(buttonGroup);\n            }\n            buttonGroup = document.createElement('div');\n            buttonGroup.classList = 'btn-group';\n            continue;\n        }\n\n        button = fig.buttons[name] = document.createElement('button');\n        button.classList = 'btn btn-default';\n        button.href = '#';\n        button.title = name;\n        button.innerHTML = '<i class=\"fa ' + image + ' fa-lg\"></i>';\n        button.addEventListener('click', on_click_closure(method_name));\n        button.addEventListener('mouseover', on_mouseover_closure(tooltip));\n        buttonGroup.appendChild(button);\n    }\n\n    if (buttonGroup.hasChildNodes()) {\n        toolbar.appendChild(buttonGroup);\n    }\n\n    // Add the status bar.\n    var status_bar = document.createElement('span');\n    status_bar.classList = 'mpl-message pull-right';\n    toolbar.appendChild(status_bar);\n    this.message = status_bar;\n\n    // Add the close button to the window.\n    var buttongrp = document.createElement('div');\n    buttongrp.classList = 'btn-group inline pull-right';\n    button = document.createElement('button');\n    button.classList = 'btn btn-mini btn-primary';\n    button.href = '#';\n    button.title = 'Stop Interaction';\n    button.innerHTML = '<i class=\"fa fa-power-off icon-remove icon-large\"></i>';\n    button.addEventListener('click', function (_evt) {\n        fig.handle_close(fig, {});\n    });\n    button.addEventListener(\n        'mouseover',\n        on_mouseover_closure('Stop Interaction')\n    );\n    buttongrp.appendChild(button);\n    var titlebar = this.root.querySelector('.ui-dialog-titlebar');\n    titlebar.insertBefore(buttongrp, titlebar.firstChild);\n};\n\nmpl.figure.prototype._remove_fig_handler = function (event) {\n    var fig = event.data.fig;\n    if (event.target !== this) {\n        // Ignore bubbled events from children.\n        return;\n    }\n    fig.close_ws(fig, {});\n};\n\nmpl.figure.prototype._root_extra_style = function (el) {\n    el.style.boxSizing = 'content-box'; // override notebook setting of border-box.\n};\n\nmpl.figure.prototype._canvas_extra_style = function (el) {\n    // this is important to make the div 'focusable\n    el.setAttribute('tabindex', 0);\n    // reach out to IPython and tell the keyboard manager to turn it's self\n    // off when our div gets focus\n\n    // location in version 3\n    if (IPython.notebook.keyboard_manager) {\n        IPython.notebook.keyboard_manager.register_events(el);\n    } else {\n        // location in version 2\n        IPython.keyboard_manager.register_events(el);\n    }\n};\n\nmpl.figure.prototype._key_event_extra = function (event, _name) {\n    var manager = IPython.notebook.keyboard_manager;\n    if (!manager) {\n        manager = IPython.keyboard_manager;\n    }\n\n    // Check for shift+enter\n    if (event.shiftKey && event.which === 13) {\n        this.canvas_div.blur();\n        // select the cell after this one\n        var index = IPython.notebook.find_cell_index(this.cell_info[0]);\n        IPython.notebook.select(index + 1);\n    }\n};\n\nmpl.figure.prototype.handle_save = function (fig, _msg) {\n    fig.ondownload(fig, null);\n};\n\nmpl.find_output_cell = function (html_output) {\n    // Return the cell and output element which can be found *uniquely* in the notebook.\n    // Note - this is a bit hacky, but it is done because the \"notebook_saving.Notebook\"\n    // IPython event is triggered only after the cells have been serialised, which for\n    // our purposes (turning an active figure into a static one), is too late.\n    var cells = IPython.notebook.get_cells();\n    var ncells = cells.length;\n    for (var i = 0; i < ncells; i++) {\n        var cell = cells[i];\n        if (cell.cell_type === 'code') {\n            for (var j = 0; j < cell.output_area.outputs.length; j++) {\n                var data = cell.output_area.outputs[j];\n                if (data.data) {\n                    // IPython >= 3 moved mimebundle to data attribute of output\n                    data = data.data;\n                }\n                if (data['text/html'] === html_output) {\n                    return [cell, data, j];\n                }\n            }\n        }\n    }\n};\n\n// Register the function which deals with the matplotlib target/channel.\n// The kernel may be null if the page has been refreshed.\nif (IPython.notebook.kernel !== null) {\n    IPython.notebook.kernel.comm_manager.register_target(\n        'matplotlib',\n        mpl.mpl_figure_comm\n    );\n}\n"}}, {"output_type": "display_data", "metadata": {}, "data": {"text/plain": "<IPython.core.display.HTML object>", "text/html": "<div id='7d6de865-be8c-4fe7-b0ad-eaffe61da4e6'></div>"}}]}}, "9496c1c3db4e40419aedbab6a475c8aa": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "6419337e01ab4bc88a467c3704545a4e": {"model_name": "SliderStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "SliderStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": "", "handle_color": null}}, "f09c90b14a534951a0afb2ab0c3b3091": {"model_name": "FloatSliderModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatSliderModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "FloatSliderView", "continuous_update": true, "description": "v", "description_tooltip": null, "disabled": false, "layout": "IPY_MODEL_9496c1c3db4e40419aedbab6a475c8aa", "max": 3.0, "min": -3.0, "orientation": "horizontal", "readout": true, "readout_format": ".2f", "step": 0.2, "style": "IPY_MODEL_6419337e01ab4bc88a467c3704545a4e", "value": 0.0}}, "4bc99d48fa45407dae8a0b56340ac63e": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "16d77b6b149349c2959118b5929a2337": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_f09c90b14a534951a0afb2ab0c3b3091", "IPY_MODEL_7d61a239d11741df9506deb02e526e21"], "layout": "IPY_MODEL_4bc99d48fa45407dae8a0b56340ac63e"}}, "e78435a06f8140d5b8090ddea54b5a35": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7d61a239d11741df9506deb02e526e21": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_e78435a06f8140d5b8090ddea54b5a35", "msg_id": "", "outputs": []}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "compimg"
        },
        kernelOptions: {
            kernelName: "compimg",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'compimg'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="05_NeuralNetworksForCompImg.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Neural Networks for Computational Imaging</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dr.-Ing. Johannes Meyer<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>